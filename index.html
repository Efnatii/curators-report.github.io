<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Отчет по кураторской деятельности</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="hero">
    <div class="container hero__content">
      <div class="hero__badge">Анкета</div>
      <h1>Отчет по кураторской деятельности</h1>
      <p class="lede">Анкета для фиксации данных кураторской деятельности.</p>
      <div class="hero__meta" aria-label="Выбор отчетного периода">
        <div class="period-picker">
          <div class="period-picker__manual" aria-label="Ручной ввод отчетного периода">
            <label class="period-picker__field">
              <span class="period-picker__field-label">Номер периода</span>
              <div class="select-shell select-shell--compact">
                <select id="reporting-period-label" class="period-picker__input" aria-label="Номер периода">
                  <option value="" disabled selected hidden>Выберите номер периода</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
            </label>
            <label class="period-picker__field">
              <span class="period-picker__field-label">Дата начала</span>
              <input type="date" id="reporting-period-start" class="period-picker__input" />
            </label>
            <label class="period-picker__field">
              <span class="period-picker__field-label">Дата окончания</span>
              <input type="date" id="reporting-period-end" class="period-picker__input" />
            </label>
            <label class="period-picker__field">
              <span class="period-picker__field-label">Крайний срок отправки</span>
              <input type="date" id="reporting-period-deadline" class="period-picker__input" />
            </label>
          </div>
          <p class="period-picker__hint">Изменяйте значения вручную, если отчётные периоды меняются.</p>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <form id="curator-form" class="form">
        <section class="form-section" aria-labelledby="section-general">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 1 из 5</p>
              <h2 id="section-general">Общие сведения о кураторе</h2>
              <p class="muted">Вводная информация для идентификации куратора и его группы.</p>
            </div>
          </div>
          <div class="field-grid">
            <label class="field">
              <span class="field__label">1. Фамилия Имя Отчество *</span>
              <input type="text" name="full_name" placeholder="Например, Иванов Иван Иванович" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">2. Должность *</span>
                <div class="field__meta">
                  <div class="tooltip">
                    <button
                      type="button"
                      class="tooltip__trigger"
                      aria-label="Подсказка: добавляйте по одной должности в каждую строку"
                    aria-expanded="false"
                  >
                    ?
                  </button>
                  <div class="tooltip__bubble" role="tooltip">Выберите одну или несколько должностей через поиск.</div>
                </div>
              </div>
              </div>
              <div class="multi-select" data-name="job_positions">
                <div
                  class="multi-select__control"
                  role="combobox"
                  aria-haspopup="listbox"
                  aria-expanded="false"
                  aria-owns="job-positions-list"
                >
                  <div class="multi-select__values" aria-live="polite"></div>
                  <input
                    type="text"
                    class="multi-select__input"
                    placeholder="Начните вводить должность"
                    aria-label="Поиск должности"
                  />
                  <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
                </div>
                <div class="multi-select__dropdown" id="job-positions-list" role="listbox"></div>
                <div class="multi-select__hidden" aria-hidden="true"></div>
                <input
                  type="text"
                  class="multi-select__validator"
                  name="job_positions_validator"
                  aria-hidden="true"
                  tabindex="-1"
                  required
                />
              </div>
            </div>
            <label class="field">
              <span class="field__label">3. Кафедра *</span>
              <input
                type="text"
                name="department"
                class="input--datalist"
                list="department-options"
                placeholder="Начните вводить название кафедры"
                required
              />
              <datalist id="department-options">
                <option value="Военный учебный центр при ГУАП"></option>
                <option value="Инженерная школа ГУАП"></option>
                <option value="Кафедра 1"></option>
                <option value="Кафедра 11"></option>
                <option value="Кафедра 12"></option>
                <option value="Кафедра 13"></option>
                <option value="Кафедра 14"></option>
                <option value="Кафедра 2"></option>
                <option value="Кафедра 21"></option>
                <option value="Кафедра 22"></option>
                <option value="Кафедра 23"></option>
                <option value="Кафедра 24"></option>
                <option value="Кафедра 25"></option>
                <option value="Кафедра 3"></option>
                <option value="Кафедра 31"></option>
                <option value="Кафедра 32"></option>
                <option value="Кафедра 33"></option>
                <option value="Кафедра 41"></option>
                <option value="Кафедра 42"></option>
                <option value="Кафедра 43"></option>
                <option value="Кафедра 44"></option>
                <option value="Кафедра 5"></option>
                <option value="Кафедра 6"></option>
                <option value="Кафедра 61"></option>
                <option value="Кафедра 62"></option>
                <option value="Кафедра 63"></option>
                <option value="Кафедра 64"></option>
                <option value="Кафедра 81"></option>
                <option value="Кафедра 82"></option>
                <option value="Кафедра 83"></option>
                <option value="Кафедра 84"></option>
                <option value="Кафедра 85"></option>
                <option value="Сетевая кафедра"></option>
              </datalist>
            </label>
            <label class="field">
              <span class="field__label">4. Контактный телефон (подключенный к Telegram) *</span>
              <input type="tel" name="contact_phone_connected_to_telegram" placeholder="Например, +7 999 000-00-00" required />
            </label>
            <label class="field">
              <span class="field__label">5. Ник в Telegram *</span>
              <input type="text" name="telegram_username" placeholder="Например, @curator_help" required />
            </label>
            <label class="field">
              <span class="field__label">6. E-mail *</span>
              <input type="email" name="email" placeholder="Например, curator@example.ru" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">7. Номера курируемых групп *</span>
                <div class="field__meta">
                  <div class="tooltip">
                    <button
                      type="button"
                      class="tooltip__trigger"
                      aria-label="Подсказка: добавьте по одному номеру группы в каждую строку"
                      aria-expanded="false"
                    >
                      ?
                    </button>
                    <div class="tooltip__bubble" role="tooltip">Добавьте по одному номеру группы в каждую строку.</div>
                  </div>
                  <button type="button" class="chip chip--interactive" data-add="curated_group_numbers">Добавить</button>
                </div>
              </div>
              <div class="multi-input" data-name="curated_group_numbers"></div>
            </div>
            <label class="field">
              <span class="field__label">8. Корпус основного пребывания куратора *</span>
              <div class="select-shell">
                <select name="curator_primary_building" required>
                  <option value="" disabled selected hidden>Выберите адрес</option>
                  <option value="190000, Россия, г. Санкт-Петербург, ул. Большая Морская, д. 67">
                    190000, Россия, г. Санкт-Петербург, ул. Большая Морская, д. 67
                  </option>
                  <option value="196066, Россия, г. Санкт-Петербург, ул. Гастелло, д. 15">
                    196066, Россия, г. Санкт-Петербург, ул. Гастелло, д. 15
                  </option>
                  <option value="196135, Россия, г. Санкт-Петербург, ул. Ленсовета, д. 14">
                    196135, Россия, г. Санкт-Петербург, ул. Ленсовета, д. 14
                  </option>
                  <option value="195067, Россия, г. Санкт-Петербург, ул. Маршала Тухачевского, д. 22">
                    195067, Россия, г. Санкт-Петербург, ул. Маршала Тухачевского, д. 22
                  </option>
                  <option value="196128, Россия, г. Санкт-Петербург, Московский проспект, д. 149">
                    196128, Россия, г. Санкт-Петербург, Московский проспект, д. 149
                  </option>
                </select>
              </div>
            </label>
            <label class="field">
              <span class="field__label">9. Аудитория основного пребывания куратора *</span>
              <input
                type="text"
                name="curator_primary_room"
                class="input--datalist"
                list="curator-primary-room-options"
                placeholder="Начните вводить аудиторию"
                required
              />
              <datalist id="curator-primary-room-options">
                <option value="(Б. Морская 67)"></option>
                <option value="11-01а (Б. Морская 67)"></option>
                <option value="11-01б (Б. Морская 67)"></option>
                <option value="11-02 (Б. Морская 67)"></option>
                <option value="12-06 (Б. Морская 67)"></option>
                <option value="12-07 (Б. Морская 67)"></option>
                <option value="12-09 (Б. Морская 67)"></option>
                <option value="12-10 (Б. Морская 67)"></option>
                <option value="12-12 (Б. Морская 67)"></option>
                <option value="12-14 (Б. Морская 67)"></option>
                <option value="12-29 (Б. Морская 67)"></option>
                <option value="12-30 (Б. Морская 67)"></option>
                <option value="12-31 (Б. Морская 67)"></option>
                <option value="12-43 (Б. Морская 67)"></option>
                <option value="13-03а (Б. Морская 67)"></option>
                <option value="13-03б (Б. Морская 67)"></option>
                <option value="13-04 (Б. Морская 67)"></option>
                <option value="13-04а (Б. Морская 67)"></option>
                <option value="13-05 (Б. Морская 67)"></option>
                <option value="13-07 (Б. Морская 67)"></option>
                <option value="13-10 (Б. Морская 67)"></option>
                <option value="13-12 (Б. Морская 67)"></option>
                <option value="13-13 (Б. Морская 67)"></option>
                <option value="13-14 (Б. Морская 67)"></option>
                <option value="13-15 (Б. Морская 67)"></option>
                <option value="13-16 (Б. Морская 67)"></option>
                <option value="13-17 (Б. Морская 67)"></option>
                <option value="14-03 (Б. Морская 67)"></option>
                <option value="14-05 (Б. Морская 67)"></option>
                <option value="14-06в (Б. Морская 67)"></option>
                <option value="14-06г (Б. Морская 67)"></option>
                <option value="14-06д (Б. Морская 67)"></option>
                <option value="14-06е (Б. Морская 67)"></option>
                <option value="14-07 (Б. Морская 67)"></option>
                <option value="14-07б (Б. Морская 67)"></option>
                <option value="14-28 (Б. Морская 67)"></option>
                <option value="14-33 (Б. Морская 67)"></option>
                <option value="14-34 (Б. Морская 67)"></option>
                <option value="14-42 (Б. Морская 67)"></option>
                <option value="14-53 (Б. Морская 67)"></option>
                <option value="14-56 (Б. Морская 67)"></option>
                <option value="14-58 (Б. Морская 67)"></option>
                <option value="21-04 (Б. Морская 67)"></option>
                <option value="21-05 (Б. Морская 67)"></option>
                <option value="21-06 (Б. Морская 67)"></option>
                <option value="21-07 (Б. Морская 67)"></option>
                <option value="21-09 (Б. Морская 67)"></option>
                <option value="21-10 (Б. Морская 67)"></option>
                <option value="21-12 (Б. Морская 67)"></option>
                <option value="21-13 (Б. Морская 67)"></option>
                <option value="21-16 (Б. Морская 67)"></option>
                <option value="21-18 (Б. Морская 67)"></option>
                <option value="21-21 (Б. Морская 67)"></option>
                <option value="22-02 (Б. Морская 67)"></option>
                <option value="22-03 (Б. Морская 67)"></option>
                <option value="22-06 (Б. Морская 67)"></option>
                <option value="22-07 (Б. Морская 67)"></option>
                <option value="22-08 (Б. Морская 67)"></option>
                <option value="22-10 (Б. Морская 67)"></option>
                <option value="22-13 (Б. Морская 67)"></option>
                <option value="22-14 (Б. Морская 67)"></option>
                <option value="22-15 (Б. Морская 67)"></option>
                <option value="23-08 (Б. Морская 67)"></option>
                <option value="23-09 (Б. Морская 67)"></option>
                <option value="23-10 (Б. Морская 67)"></option>
                <option value="23-17 (Б. Морская 67)"></option>
                <option value="23-22 (Б. Морская 67)"></option>
                <option value="31-01 (Б. Морская 67)"></option>
                <option value="31-02 (Б. Морская 67)"></option>
                <option value="31-03 (Б. Морская 67)"></option>
                <option value="31-04 (Б. Морская 67)"></option>
                <option value="31-05 (Б. Морская 67)"></option>
                <option value="31-06 (Б. Морская 67)"></option>
                <option value="32-02 (Б. Морская 67)"></option>
                <option value="32-03 (Б. Морская 67)"></option>
                <option value="32-04 (Б. Морская 67)"></option>
                <option value="33-02 (Б. Морская 67)"></option>
                <option value="33-04 (Б. Морская 67)"></option>
                <option value="33-05 (Б. Морская 67)"></option>
                <option value="33-07 (Б. Морская 67)"></option>
                <option value="51-02в (Б. Морская 67)"></option>
                <option value="51-06-01 (Б. Морская 67)"></option>
                <option value="51-06-02 (Б. Морская 67)"></option>
                <option value="51-06-03 (Б. Морская 67)"></option>
                <option value="51-06-05 (Б. Морская 67)"></option>
                <option value="51-07 (Б. Морская 67)"></option>
                <option value="51-08 (Б. Морская 67)"></option>
                <option value="52-03 (Б. Морская 67)"></option>
                <option value="52-04 (Б. Морская 67)"></option>
                <option value="52-07 (Б. Морская 67)"></option>
                <option value="52-08 (Б. Морская 67)"></option>
                <option value="52-09 (Б. Морская 67)"></option>
                <option value="52-15 (Б. Морская 67)"></option>
                <option value="52-16 (Б. Морская 67)"></option>
                <option value="52-17 (Б. Морская 67)"></option>
                <option value="52-18 (Б. Морская 67)"></option>
                <option value="52-19 (Б. Морская 67)"></option>
                <option value="52-23а (Б. Морская 67)"></option>
                <option value="52-23б (Б. Морская 67)"></option>
                <option value="52-24 (Б. Морская 67)"></option>
                <option value="52-25 (Б. Морская 67)"></option>
                <option value="52-33 (Б. Морская 67)"></option>
                <option value="52-35 (Б. Морская 67)"></option>
                <option value="52-37 (Б. Морская 67)"></option>
                <option value="52-39 (Б. Морская 67)"></option>
                <option value="52-42 (Б. Морская 67)"></option>
                <option value="52-43 (Б. Морская 67)"></option>
                <option value="52-44 (Б. Морская 67)"></option>
                <option value="52-46 (Б. Морская 67)"></option>
                <option value="52-48 (Б. Морская 67)"></option>
                <option value="52-49 (Б. Морская 67)"></option>
                <option value="52-50 (Б. Морская 67)"></option>
                <option value="52-51 (Б. Морская 67)"></option>
                <option value="52-53 (Б. Морская 67)"></option>
                <option value="52-53а (Б. Морская 67)"></option>
                <option value="53-03 (Б. Морская 67)"></option>
                <option value="53-04 (Б. Морская 67)"></option>
                <option value="53-07 (Б. Морская 67)"></option>
                <option value="53-09 (Б. Морская 67)"></option>
                <option value="53-10 (Б. Морская 67)"></option>
                <option value="54-01 (Б. Морская 67)"></option>
                <option value="54-06 (Б. Морская 67)"></option>
                <option value="спортзал (Б. Морская 67)"></option>
                <option value="(вне сетки)"></option>
                <option value="11-05 (Гастелло 15)"></option>
                <option value="11-06 (Гастелло 15)"></option>
                <option value="12-01 (Гастелло 15)"></option>
                <option value="12-02 (Гастелло 15)"></option>
                <option value="12-03 (Гастелло 15)"></option>
                <option value="12-04 (Гастелло 15)"></option>
                <option value="12-05 (Гастелло 15)"></option>
                <option value="12-06 (Гастелло 15)"></option>
                <option value="12-08 (Гастелло 15)"></option>
                <option value="13-03 (Гастелло 15)"></option>
                <option value="13-09 (Гастелло 15)"></option>
                <option value="13-10 (Гастелло 15)"></option>
                <option value="13-12 (Гастелло 15)"></option>
                <option value="13-15 (Гастелло 15)"></option>
                <option value="14-02 (Гастелло 15)"></option>
                <option value="14-03 (Гастелло 15)"></option>
                <option value="14-04 (Гастелло 15)"></option>
                <option value="14-05 (Гастелло 15)"></option>
                <option value="14-06 (Гастелло 15)"></option>
                <option value="22-03 (Гастелло 15)"></option>
                <option value="22-04 (Гастелло 15)"></option>
                <option value="22-06 (Гастелло 15)"></option>
                <option value="22-07 (Гастелло 15)"></option>
                <option value="22-08 (Гастелло 15)"></option>
                <option value="22-10 (Гастелло 15)"></option>
                <option value="22-11 (Гастелло 15)"></option>
                <option value="22-13 (Гастелло 15)"></option>
                <option value="24-01 (Гастелло 15)"></option>
                <option value="24-02 (Гастелло 15)"></option>
                <option value="24-03 (Гастелло 15)"></option>
                <option value="24-05 (Гастелло 15)"></option>
                <option value="24-06 (Гастелло 15)"></option>
                <option value="24-08 (Гастелло 15)"></option>
                <option value="24-09 (Гастелло 15)"></option>
                <option value="24-10 (Гастелло 15)"></option>
                <option value="24-11 (Гастелло 15)"></option>
                <option value="24-12 (Гастелло 15)"></option>
                <option value="24-14 (Гастелло 15)"></option>
                <option value="24-16 (Гастелло 15)"></option>
                <option value="31-02 (Гастелло 15)"></option>
                <option value="31-03 (Гастелло 15)"></option>
                <option value="31-04а (Гастелло 15)"></option>
                <option value="31-04б (Гастелло 15)"></option>
                <option value="31-04в (Гастелло 15)"></option>
                <option value="32-01 (Гастелло 15)"></option>
                <option value="32-02 (Гастелло 15)"></option>
                <option value="32-03 (Гастелло 15)"></option>
                <option value="32-04 (Гастелло 15)"></option>
                <option value="32-05 (Гастелло 15)"></option>
                <option value="32-06 (Гастелло 15)"></option>
                <option value="33-01 (Гастелло 15)"></option>
                <option value="33-02 (Гастелло 15)"></option>
                <option value="33-03 (Гастелло 15)"></option>
                <option value="33-04 (Гастелло 15)"></option>
                <option value="33-05 (Гастелло 15)"></option>
                <option value="33-06 (Гастелло 15)"></option>
                <option value="33-08 (Гастелло 15)"></option>
                <option value="33-09 (Гастелло 15)"></option>
                <option value="34-02 (Гастелло 15)"></option>
                <option value="34-03 (Гастелло 15)"></option>
                <option value="34-04 (Гастелло 15)"></option>
                <option value="34-05 (Гастелло 15)"></option>
                <option value="34-06 (Гастелло 15)"></option>
                <option value="34-07 (Гастелло 15)"></option>
                <option value="34-08 (Гастелло 15)"></option>
                <option value="34-09 (Гастелло 15)"></option>
                <option value="34-10 (Гастелло 15)"></option>
                <option value="34-12 (Гастелло 15)"></option>
                <option value="34-13 (Гастелло 15)"></option>
                <option value="34-18 (Гастелло 15)"></option>
                <option value="с-34 (Гастелло 15)"></option>
                <option value="с-36 (Гастелло 15)"></option>
                <option value="(Дистант)"></option>
                <option value="11-08 (Ленсовета 14)"></option>
                <option value="12-05 (Ленсовета 14)"></option>
                <option value="12-07 (Ленсовета 14)"></option>
                <option value="12-08 (Ленсовета 14)"></option>
                <option value="12-09 (Ленсовета 14)"></option>
                <option value="12-14 (Ленсовета 14)"></option>
                <option value="12-15 (Ленсовета 14)"></option>
                <option value="12-19 (Ленсовета 14)"></option>
                <option value="13-03 (Ленсовета 14)"></option>
                <option value="13-04 (Ленсовета 14)"></option>
                <option value="13-05 (Ленсовета 14)"></option>
                <option value="13-06 (Ленсовета 14)"></option>
                <option value="13-07 (Ленсовета 14)"></option>
                <option value="13-19 (Ленсовета 14)"></option>
                <option value="14-05 (Ленсовета 14)"></option>
                <option value="14-06 (Ленсовета 14)"></option>
                <option value="14-07 (Ленсовета 14)"></option>
                <option value="14-08 (Ленсовета 14)"></option>
                <option value="14-09 (Ленсовета 14)"></option>
                <option value="14-10 (Ленсовета 14)"></option>
                <option value="14-11 (Ленсовета 14)"></option>
                <option value="14-14 (Ленсовета 14)"></option>
                <option value="14-15 (Ленсовета 14)"></option>
                <option value="21-04 (Ленсовета 14)"></option>
                <option value="21-11 (Ленсовета 14)"></option>
                <option value="22-02 (Ленсовета 14)"></option>
                <option value="22-04 (Ленсовета 14)"></option>
                <option value="22-07 (Ленсовета 14)"></option>
                <option value="22-09 (Ленсовета 14)"></option>
                <option value="22-14 (Ленсовета 14)"></option>
                <option value="22-16 (Ленсовета 14)"></option>
                <option value="23-01 (Ленсовета 14)"></option>
                <option value="23-02 (Ленсовета 14)"></option>
                <option value="23-04 (Ленсовета 14)"></option>
                <option value="23-06 (Ленсовета 14)"></option>
                <option value="23-09 (Ленсовета 14)"></option>
                <option value="23-12 (Ленсовета 14)"></option>
                <option value="24-03 (Ленсовета 14)"></option>
                <option value="24-06 (Ленсовета 14)"></option>
                <option value="24-10 (Ленсовета 14)"></option>
                <option value="24-13 (Ленсовета 14)"></option>
                <option value="24-15 (Ленсовета 14)"></option>
                <option value="24-16 (Ленсовета 14)"></option>
                <option value="32-01 (Ленсовета 14)"></option>
                <option value="32-04 (Ленсовета 14)"></option>
                <option value="32-11 (Ленсовета 14)"></option>
                <option value="32-13 (Ленсовета 14)"></option>
                <option value="33-07 (Ленсовета 14)"></option>
                <option value="33-08 (Ленсовета 14)"></option>
                <option value="33-09 (Ленсовета 14)"></option>
                <option value="34-04 (Ленсовета 14)"></option>
                <option value="34-05 (Ленсовета 14)"></option>
                <option value="34-06 (Ленсовета 14)"></option>
                <option value="спортзал (Ленсовета 14)"></option>
                <option value="(Маршала Тухачевского 22)"></option>
                <option value="116 (Московский 149)"></option>
                <option value="406 (Московский 149)"></option>
                <option value="410 (Московский 149)"></option>
                <option value="411 (Московский 149)"></option>
                <option value="416 (Московский 149)"></option>
                <option value="417 (Московский 149)"></option>
                <option value="423 (Московский 149)"></option>
              </datalist>
            </label>
          </div>
          <fieldset class="choice-card">
            <legend class="legend-with-tooltip">
              <span>10. Институт/Факультет *</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: можно выбрать один или несколько вариантов"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Выберите один или несколько вариантов.</div>
              </div>
            </legend>
            <div class="choices">
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт аэрокосмических приборов и систем" />
                <span>Институт аэрокосмических приборов и систем</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт радиотехники и инфокоммуникационных технологий" />
                <span>Институт радиотехники и инфокоммуникационных технологий</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт киберфизических систем" />
                <span>Институт киберфизических систем</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт информационных технологий и программирования" />
                <span>Институт информационных технологий и программирования</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт фундаментальной подготовки и технологических инноваций" />
                <span>Институт фундаментальной подготовки и технологических инноваций</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Гуманитарный факультет" />
                <span>Гуманитарный факультет</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт технологий предпринимательства и права" />
                <span>Институт технологий предпринимательства и права</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Военный учебный центр при ГУАП (ВУЦ)" />
                <span>Военный учебный центр при ГУАП (ВУЦ)</span>
              </label>
            </div>
        </fieldset>
      </section>

        <section class="form-section" aria-labelledby="section-curator-hours">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 2 из 5</p>
              <h2 id="section-curator-hours">Информация о проведении кураторских часов</h2>
              <p class="muted">Данные о количестве, тематиках и направлениях проведённых кураторских часов</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">11. Проведение не менее трех кураторских часов за отчетный период *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="held_minimum_three_curator_sessions_in_reporting_period" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="held_minimum_three_curator_sessions_in_reporting_period" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="curator-hours-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                <p class="section-counter">Дополнительный вопрос</p>
                <h3 id="question-12">12. Даты проведения трех и более кураторских часов в течение отчетного периода</h3>
                <p class="muted">Заполните данные по каждому проведенному кураторскому часу.</p>
              </div>
              <div class="tooltip tooltip--standalone">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: укажите минимум три записи с деталями каждого кураторского часа"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Укажите минимум три записи с деталями каждого кураторского часа.</div>
              </div>
              <button type="button" class="chip chip--interactive" id="add-curator-hour-row">Добавить строку</button>
            </div>

            <div class="curator-hours" id="curator-hours-rows"></div>
          </div>
        </section>

        <section class="form-section" aria-labelledby="section-collaboration">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 3 из 5</p>
              <h2 id="section-collaboration">Совместные мероприятия с курируемой группой</h2>
              <p class="muted">Отражает совместную активность куратора и студентов.</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">13. Ведение чата с каждой группой или общего чата со всеми группами *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="manages_group_chat" value="true" />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="manages_group_chat" value="false" />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <fieldset class="choice-card">
            <legend class="field__label">14. Информирование группы о мероприятиях и событиях различного уровня *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="inform_group_about_events" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="inform_group_about_events" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="joint-activities-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                  <h3 class="additional-title">Дополнительные вопросы</h3>
              </div>
            </div>

            <div class="form-subsection form-subsection--borderless">
              <div class="section-header section-header--sub">
                <div>
                  <h3>15. Призовое место обучающегося во внеучебных мероприятиях, конкурсах, получение грантов</h3>
                  <p class="muted">Добавьте записи только при наличии результатов. Таблица по умолчанию пустая.</p>
                </div>
                <button type="button" class="chip chip--interactive" id="add-achievement-row">Добавить строку</button>
              </div>
              <div class="achievement-table" id="achievement-rows"></div>
            </div>

            <fieldset class="choice-card">
            <legend class="field__label">16. Совместное участие с группой не менее чем в двух мероприятиях в течение отчетного периода *</legend>
              <div class="choices">
                <label class="choice">
                  <input type="radio" name="participated_in_two_events_with_group" value="true" />
                  <span>Да</span>
                </label>
                <label class="choice">
                  <input type="radio" name="participated_in_two_events_with_group" value="false" />
                  <span>Нет</span>
                </label>
              </div>
            </fieldset>

            <div id="joint-events-details" class="form-subsection" hidden>
              <div class="section-header section-header--sub">
                <div>
                  <p class="section-counter">Дополнительный вопрос</p>
                  <h3>17. Даты проведения двух и более мероприятий в течение отчетного периода</h3>
                  <p class="muted">Заполните данные по каждому совместному мероприятию.</p>
                </div>
                <div class="tooltip tooltip--standalone">
                  <button
                    type="button"
                    class="tooltip__trigger"
                    aria-label="Подсказка: укажите минимум две записи с деталями каждого мероприятия"
                    aria-expanded="false"
                  >
                    ?
                  </button>
                  <div class="tooltip__bubble" role="tooltip">Укажите минимум две записи с деталями каждого мероприятия.</div>
                </div>
                <button type="button" class="chip chip--interactive" id="add-joint-event-row">Добавить строку</button>
              </div>
              <div class="joint-events" id="joint-event-rows"></div>
            </div>
          </div>
        </section>

        <section class="form-section" aria-labelledby="section-curator-extracurricular">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 4 из 5</p>
              <h2 id="section-curator-extracurricular">Внеучебная деятельность куратора</h2>
              <p class="muted">Личное участие и наставничество куратора в программах, форумах и конкурсах.</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">
              18. Участие не менее чем в двух мероприятиях  для кураторов: собрания, совещания,  тренинги, мастер-классы, конкурс
              кураторов *
            </legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="participated_in_two_curator_events" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="participated_in_two_curator_events" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="curator-extracurricular-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                <p class="section-counter">Дополнительный вопрос</p>
                <h3>
                  19. Даты участия не менее чем в двух мероприятиях  для кураторов: собрания, совещания, тренинги, мастер-классы,
                  конкурс кураторов
                </h3>
                <p class="muted">Заполните данные по каждому мероприятию.</p>
              </div>
              <div class="tooltip tooltip--standalone">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: укажите минимум две записи с деталями каждого мероприятия"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Укажите минимум две записи с деталями каждого мероприятия.</div>
              </div>
              <button type="button" class="chip chip--interactive" id="add-extracurricular-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="extracurricular-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>
                  20. Личное участие в региональных, межмуниципальных, федеральных программах, конкурсах, мероприятиях по работе с
                  детьми и молодежью, воспитательной работе, молодежной политике (форумы, «Голос поколения», конкурс кураторов РГПУ
                  им. Герцена и т.д.)
                </h3>
                <p class="muted">Добавьте записи по необходимости. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-personal-program-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="personal-program-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>
                  21. Участие куратора в роли наставника проекта, а также в подготовке к чемпионату, конкурсу, конференции и др.
                </h3>
                <p class="muted">Добавьте записи только при наличии наставничества. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-mentor-support-row">Добавить строку</button>
            </div>
            <div class="achievement-table" id="mentor-support-rows"></div>
          </div>
        </section>

        <section class="form-section" aria-labelledby="section-academic">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 5 из 5</p>
              <h2 id="section-academic">Научная и методическая деятельность куратора</h2>
              <p class="muted">Публикации, методические материалы, повышение квалификации.</p>
            </div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>
                  22. Опубликование научной работы (в том числе монографии, научной статьи, доклада, тезисов доклада и т.д. на
                  темы, связанные с молодежной политикой и воспитательной деятельностью, с указанием принадлежности автора к ГУАП
                  (в том числе в форме электронного издания))
                </h3>
                <p class="muted">Добавьте записи при наличии публикаций. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-scientific-work-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="scientific-work-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>23. Интервью и статьи для «Дзен.ГУАП», соцсетей и сайта ГУАП</h3>
                <p class="muted">Добавьте ссылки на опубликованные материалы.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-interview-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="interview-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>24. Курсы повышения квалификации в области молодежной политики и воспитательной деятельности</h3>
                <p class="muted">Добавьте записи только при наличии повышения квалификации. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-qualification-course-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="qualification-course-rows"></div>
          </div>
        </section>

        <div class="actions">
          <button type="button" id="import-json-button" class="button button--secondary">Импорт из JSON</button>
          <button type="button" id="export-json-button" class="button button--emphasis">Экспорт в JSON</button>
          <button type="button" id="export-pdf-button" class="button button--ghost">
            <span>Экспорт в PDF</span>
            <span class="button__note">*только для самопроверки</span>
          </button>
          <p class="muted">Используйте кнопки, чтобы импортировать ответы или экспортировать их в форматах JSON и PDF.</p>
          <input type="file" id="import-json-input" accept="application/json" hidden />
        </div>
      </form>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__content">
      <div class="footer__links">
        <a href="#section-general">К началу формы</a>
      </div>
      <p class="footnote">
        © Copyrights —
        <a href="https://github.com/Efnatii" rel="noopener noreferrer">Efnatii</a>
        (Гороховицкий Е. Р.).
        <a href="LICENSE" rel="license noopener noreferrer">MIT License</a>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/pdfmake.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/vfs_fonts.js"></script>
  <script>
    const form = document.getElementById('curator-form');
    const reportingPeriodLabelInput = document.getElementById('reporting-period-label');
    const reportingPeriodStartInput = document.getElementById('reporting-period-start');
    const reportingPeriodEndInput = document.getElementById('reporting-period-end');
    const reportingPeriodDeadlineInput = document.getElementById('reporting-period-deadline');
    const importButton = document.getElementById('import-json-button');
    const importInput = document.getElementById('import-json-input');
    const exportJsonButton = document.getElementById('export-json-button');
    const exportPdfButton = document.getElementById('export-pdf-button');
    const curatorHoursDetails = document.getElementById('curator-hours-details');
    const curatorHoursRows = document.getElementById('curator-hours-rows');
    const addCuratorHourRowButton = document.getElementById('add-curator-hour-row');
    const jointActivitiesDetails = document.getElementById('joint-activities-details');
    const addAchievementRowButton = document.getElementById('add-achievement-row');
    const achievementRowsContainer = document.getElementById('achievement-rows');
    const jointEventsDetails = document.getElementById('joint-events-details');
    const jointEventRowsContainer = document.getElementById('joint-event-rows');
    const addJointEventRowButton = document.getElementById('add-joint-event-row');
    const extracurricularDetails = document.getElementById('curator-extracurricular-details');
    const extracurricularRowsContainer = document.getElementById('extracurricular-rows');
    const addExtracurricularRowButton = document.getElementById('add-extracurricular-row');
    const personalProgramRowsContainer = document.getElementById('personal-program-rows');
    const addPersonalProgramRowButton = document.getElementById('add-personal-program-row');
    const mentorSupportRowsContainer = document.getElementById('mentor-support-rows');
    const addMentorSupportRowButton = document.getElementById('add-mentor-support-row');
    const scientificWorkRowsContainer = document.getElementById('scientific-work-rows');
    const addScientificWorkRowButton = document.getElementById('add-scientific-work-row');
    const interviewRowsContainer = document.getElementById('interview-rows');
    const addInterviewRowButton = document.getElementById('add-interview-row');
    const qualificationCourseRowsContainer = document.getElementById('qualification-course-rows');
    const addQualificationCourseRowButton = document.getElementById('add-qualification-course-row');
    const achievementDirectionSelects = new WeakMap();
    const curatorHoursDirectionSelects = new WeakMap();
    const interviewDirectionSelects = new WeakMap();
    const scientificWorkDirectionSelects = new WeakMap();
    const qualificationCourseDirectionSelects = new WeakMap();
    const mentorSupportDirectionSelects = new WeakMap();
    const personalProgramDirectionSelects = new WeakMap();
    const curatorPersonalEventDirectionSelects = new WeakMap();
    const jointEventDirectionSelects = new WeakMap();
    let achievementDirectionDropdownId = 0;
    let curatorHoursDirectionDropdownId = 0;
    let interviewDirectionDropdownId = 0;
    let scientificWorkDirectionDropdownId = 0;
    let qualificationCourseDirectionDropdownId = 0;
    let jointEventDirectionDropdownId = 0;
    let mentorSupportDirectionDropdownId = 0;
    let personalProgramDirectionDropdownId = 0;
    let curatorPersonalEventDirectionDropdownId = 0;

    const directionsOptions = [
      'Гражданская',
      'Патриотическая',
      'Духовно-нравственная',
      'Волонтерская (добровольческая)',
      'Культурно-творческая',
      'Научно-образовательная',
      'Спортивно-оздоровительная',
      'Экологическая',
      'Информационная (коммуникационная)',
      'Туристическая',
      'Предпринимательская',
      'Корпоративная идентичность',
      'Профессионально-трудовая',
      'Другое: иная направленность воспитательной работы',
    ];

    const jobPositionOptions = [
      'Ассистент',
      'Преподаватель',
      'Старший преподаватель',
      'Доцент',
      'Профессор',
      'Ректор',
      'Заведующий кафедрой',
      'Доцент военного учебного центра при ГУАП',
      'Почасовая нагрузка',
      'Почасовая оплата',
      'С.н.с',
      'М.н.с',
      'Канд. техн. наук',
      'Канд. юрид. наук',
      'Канд. экон. наук',
      'Канд. пед. наук',
      'Канд. физ.-мат. наук',
      'Канд. ист. наук',
      'Канд. воен. наук',
      'Канд. филос. наук',
      'Канд. культурологии',
      'Канд. филол. наук',
      'Канд. хим. наук',
      'Канд. социол. наук',
      'Канд. биол. наук',
      'Д-р юрид. наук',
      'Д-р экон. наук',
      'Д-р техн. наук',
      'Д-р филол. наук',
      'Д-р ист. наук',
      'Д-р пед. наук',
      'Д-р биол. наук',
      'Д-р социол. наук',
      'Д-р полит. наук',
      'Д-р филос. наук',
      'Д-р физ.-мат. наук',
      'К.т.н.',
      'К.э.н.',
      'К.фил.н.',
      'Д.т.н.',
      'Д.э.н.',
    ];

    const scientificWorkDirectionOptions = [
      'Государственная молодежная политика в РФ и её реализация в вузах',
      'Общетеоретические вопросы молодежной политики',
      'Нормативно-правовое обеспечение молодежной политики и воспитательной работы',
      'Стратегия развития воспитательной работы в вузе',
      'Модели и концепции воспитательной системы вуза',
      'Воспитательная деятельность куратора академической группы',
      'Организация воспитательной работы со студенческой молодежью',
      'Психолого-педагогические основы воспитательной деятельности',
      'Социально-педагогическая поддержка студенческой молодежи',
      'Ценностные ориентиры современной молодежи',
      'Формирование гражданской идентичности студентов',
      'Гражданско-патриотическое воспитание студенческой молодежи',
      'Историко-культурное воспитание студентов',
      'Духовно-нравственное воспитание молодежи',
      'Нравственные ориентиры и этика студенческой среды',
      'Права человека и правовая культура молодежи',
      'Правовое просвещение студентов',
      'Профилактика правонарушений в молодежной среде',
      'Профилактика экстремизма, радикализации и терроризма среди молодежи',
      'Профилактика асоциального и девиантного поведения студентов',
      'Профилактика буллинга и кибербуллинга в студенческой среде',
      'Формирование культуры безопасного поведения в сети',
      'Медиаобразование и медиаграмотность студенческой молодежи',
      'Цифровая среда и ее влияние на воспитание студентов',
      'Воспитательный потенциал цифровых и онлайн-платформ',
      'Социальные сети как ресурс воспитательной работы',
      'Формирование культуры здорового образа жизни у студентов',
      'Профилактика зависимостей в молодежной среде',
      'Психологическое благополучие и ментальное здоровье студентов',
      'Психологическое сопровождение и поддержка студенческой молодежи',
      'Профилактика эмоционального выгорания студентов',
      'Развитие стрессоустойчивости и навыков саморегуляции у молодежи',
      'Развитие коммуникативной культуры и культуры общения студентов',
      'Развитие soft skills и универсальных компетенций',
      'Лидерство и развитие лидерского потенциала студенческой молодежи',
      'Студенческое самоуправление и его роль в воспитательной работе',
      'Наставничество, тьюторство и кураторство в вузе',
      'Организация деятельности студенческих клубов и объединений',
      'Волонтерство и добровольческая деятельность студентов',
      'Социальное проектирование и молодежные социальные проекты',
      'Грантовая поддержка молодежных инициатив',
      'Инклюзивная образовательная среда и воспитательная работа',
      'Сопровождение студентов с ОВЗ и особыми образовательными потребностями',
      'Межкультурная коммуникация и работа с иностранными студентами',
      'Формирование толерантности и культуры межэтнического взаимодействия',
      'Профориентация и сопровождение профессионального самоопределения студентов',
      'Карьерное развитие и поддержка трудоустройства молодежи',
      'Предпринимательская активность и бизнес-инициативы студенческой молодежи',
      'Организация досуговой деятельности и свободного времени студентов',
      'Культурно-досуговая деятельность и творческое развитие студентов',
      'Спортивно-оздоровительная работа со студенческой молодежью',
      'Экологическое воспитание и формирование экологической культуры',
      'Финансовая грамотность и экономическая культура студентов',
      'Формирование корпоративной культуры и идентичности ГУАП',
      'Взаимодействие вуза с семьями студентов в контексте воспитательной работы',
      'Взаимодействие вуза с органами власти и общественными организациями в сфере молодежной политики',
      'Оценка эффективности программ воспитательной деятельности',
      'Мониторинг воспитательной работы и аналитика в молодежной среде',
      'Локальные практики и кейсы воспитательной деятельности в ГУАП',
      'Сравнительный анализ моделей воспитательной работы в разных вузах',
      'Инновационные технологии и формы воспитательной работы со студентами',
      'Проектирование программ воспитательной деятельности и молодежной политики в вузе',
      'Информационное сопровождение воспитательной деятельности и популяризация студенческих инициатив',
      'Другое: публикация иной направленности',
    ];

    const achievementDirectionOptions = [
      'Научно-исследовательская деятельность',
      'Научно-практические конференции',
      'Предметные и профессиональные олимпиады',
      'Инженерные и конструкторские конкурсы',
      'IT-конкурсы и хакатоны',
      'Конкурсы по робототехнике и техническому творчеству',
      'Конкурсы по аэрокосмической тематике',
      'Кейс-чемпионаты',
      'Конкурсы проектных и исследовательских работ',
      'Конкурсы выпускных и курсовых проектов',
      'Конкурсы студенческих стартапов',
      'Конкурсы по предпринимательству и бизнес-идеям',
      'Получение грантов на научные проекты',
      'Получение грантов на социальные проекты',
      'Получение грантов на студенческие инициативы',
      'Получение грантов на инновационные и технологические разработки',
      'Получение грантов в области молодежной политики и воспитательной работы',
      'Конкурсы по социальному проектированию',
      'Конкурсы волонтерских и благотворительных инициатив',
      'Конкурсы гражданско-патриотических проектов',
      'Конкурсы историко-культурной направленности',
      'Конкурсы эколого-просветительских проектов',
      'Конкурсы по формированию здорового образа жизни',
      'Конкурсы по правовой и финансовой грамотности',
      'Конкурсы по развитию soft skills и лидерства',
      'Конкурсы студенческого самоуправления',
      'Конкурсы студенческих медиа и журналистики',
      'Конкурсы блогерства и SMM-проектов',
      'Конкурсы молодёжных медиацентров',
      'Творческие конкурсы (музыка, вокал, инструментальное исполнение)',
      'Творческие конкурсы (танец, хореография)',
      'Творческие конкурсы (театр, сценическое мастерство)',
      'Конкурсы изобразительного искусства и дизайна',
      'Конкурсы фото- и видеотворчества',
      'Литературные конкурсы',
      'Фестивали и конкурсы студенческого творчества',
      'Фестивали молодежных культур',
      'Конкурсы по ораторскому мастерству и дебатам',
      'Интеллектуальные игры, квизы, брейн-ринги',
      'Конкурсы по программированию и алгоритмам',
      'Конкурсы по сетевым технологиям и кибербезопасности',
      'Конкурсы по анализу данных и искусственному интеллекту',
      'Спортивные соревнования индивидуальные',
      'Спортивные соревнования командные',
      'Университетские спортивные соревнования',
      'Городские и региональные спортивные соревнования',
      'Всероссийские спортивные соревнования',
      'Конкурсы по туризму и туристско-краеведческой деятельности',
      'Конкурсы по межкультурному и международному взаимодействию',
      'Конкурсы по работе с молодежью с ОВЗ и инклюзии',
      'Конкурсы профессионального мастерства по профилю подготовки',
      'Конкурсы профессионального мастерства в сфере воспитательной работы',
      'Получение именных стипендий и специальных поощрительных выплат',
      'Победа в университетских конкурсах и рейтингах',
      'Победа в городских и региональных конкурсах',
      'Победа во всероссийских и международных конкурсах',
      'Другое внеучебное достижение призового уровня или получение гранта (указать направление)',
    ];

    const qualificationCourseDirectionOptions = [
      'Нормативно-правовые основы государственной молодежной политики',
      'Организация воспитательной и кураторской работы в вузе',
      'Психолого-педагогические основы работы с современной молодежью',
      'Современные технологии воспитательной работы со студентами',
      'Проектирование и реализация программ воспитательной деятельности в образовательной организации',
      'Развитие студенческого самоуправления и органов студенческой власти',
      'Организация работы студенческих клубов и объединений',
      'Волонтерство и социальное служение студенческой молодежи',
      'Гражданско-патриотическое воспитание студентов',
      'Духовно-нравственное воспитание молодежи',
      'Формирование гражданской идентичности и ценностей российского общества',
      'Профилактика девиантного поведения и правонарушений в молодежной среде',
      'Профилактика зависимостей в молодежной среде',
      'Профилактика экстремизма и терроризма среди молодежи',
      'Профилактика буллинга и кибербуллинга',
      'Конфликтология и медиативные технологии в работе со студентами',
      'Психологическая поддержка и сопровождение студентов',
      'Работа с эмоциональным выгоранием и стрессом у студентов',
      'Профилактика суицидального поведения в молодежной среде',
      'Формирование культуры здорового образа жизни',
      'Профилактика заболеваний и организация здоровьесберегающей среды',
      'Развитие soft skills и личностного потенциала студентов',
      'Профориентация и сопровождение карьерного выбора студентов',
      'Содействие трудоустройству и развитию предпринимательских инициатив студентов',
      'Социальное проектирование и управление молодежными проектами',
      'Организация и проведение молодежных акций, форумов и мероприятий',
      'Информационное сопровождение воспитательной работы и работа в социальных сетях',
      'Цифровая молодежная среда и медиаграмотность',
      'Формирование навыков критического мышления и противодействие фейковой информации',
      'Коммуникативная культура и развитие навыков делового общения у студентов',
      'Межкультурная коммуникация и работа с иностранными студентами',
      'Формирование толерантности и культуры межэтнического общения',
      'Инклюзивная образовательная среда и работа со студентами с ОВЗ',
      'Сопровождение студентов с особыми образовательными потребностями',
      'Работа с одаренной студенческой молодежью',
      'Поддержка студенческой науки, творчества и инициатив',
      'Организация проектной деятельности студенческой молодежи',
      'Лидерство и развитие лидерских качеств у студентов',
      'Наставничество и тьюторство в работе со студентами',
      'Взаимодействие куратора с родителями и законными представителями студентов',
      'Взаимодействие куратора с администрацией вуза и службами сопровождения',
      'Документооборот, отчетность и планирование воспитательной работы куратора',
      'Мониторинг и оценка эффективности воспитательной деятельности',
      'Правовое просвещение и формирование правовой культуры молодежи',
      'Финансовая грамотность и экономическая культура студенческой молодежи',
      'Экологическое воспитание и формирование экологической культуры',
      'Патриотические и историко-культурные проекты со студенчеством',
      'Культурно-досуговая деятельность со студентами',
      'Организация профилактической работы по сохранению ментального здоровья молодежи',
      'Этические основы работы куратора и педагогическая этика',
      'Партнерство с молодежными организациями и общественными объединениями',
      'Муниципальные и региональные молодежные программы и их использование в работе куратора',
      'Интеграция воспитательной работы с образовательным процессом',
      'Индивидуальное сопровождение студента и ведение «карты развития» обучающегося',
      'Другое: направление курса повышения квалификации (тематика не уточнена)',
    ];

    const jointEventDirectionOptions = [
      'Гражданско-патриотические мероприятия',
      'Духовно-нравственные мероприятия',
      'Историко-культурные мероприятия',
      'Культурно-досуговые мероприятия (концерты, спектакли, фестивали)',
      'Спортивно-оздоровительные мероприятия',
      'Массовые спортивные соревнования (спартакиады, забеги, турниры)',
      'Туристско-краеведческие мероприятия и экскурсии',
      'Экологические акции и мероприятия',
      'Волонтёрские и благотворительные акции',
      'Социальные проекты и акции помощи населению',
      'Профориентационные мероприятия',
      'Карьерные мероприятия (ярмарки вакансий, встречи с работодателями)',
      'Научно-популярные лекции и просветительские мероприятия',
      'Участие в научных конференциях, форумах, семинарах',
      'Участие в студенческих научных кружках и школах',
      'Образовательные интенсивы и мастер-классы',
      'Мероприятия по развитию soft skills (коммуникация, командная работа и др.)',
      'Тренинги личностного роста и лидерства',
      'Мероприятия по развитию студенческого самоуправления',
      'Школы актива, школы кураторов и лидеров',
      'Информационно-профилактические мероприятия (ЗОЖ, ПАВ и др.)',
      'Профилактика правонарушений и асоциального поведения',
      'Профилактика экстремизма, терроризма и ксенофобии',
      'Профилактика буллинга и кибербуллинга',
      'Мероприятия по формированию культуры безопасного поведения в сети',
      'Мероприятия по финансовой грамотности',
      'Мероприятия по правовой грамотности и правовой культуре',
      'Мероприятия по формированию корпоративной культуры ГУАП',
      'Кураторские часы организационно-адаптационной направленности',
      'Кураторские часы, посвящённые вопросам успеваемости и дисциплины',
      'Кураторские часы, направленные на командообразование и сплочение группы',
      'Тематические кураторские часы к памятным и праздничным датам',
      'Встречи с администрацией факультета/института',
      'Встречи с работодателями и представителями индустрии',
      'Встречи с выпускниками',
      'Совместное участие в университетских праздничных мероприятиях',
      'Совместное участие в общеуниверситетских акциях и кампаниях',
      'Мероприятия по работе с первокурсниками (адаптация, наставничество)',
      'Межкультурные и международные мероприятия',
      'Инклюзивные мероприятия и акции по поддержке лиц с ОВЗ',
      'Творческие мероприятия (конкурсы, выставки, фестивали студенческого творчества)',
      'Медиа- и IT-мероприятия (хакатоны, кибертурниры, фестивали медиа)',
      'Интеллектуальные игры, квизы, брейн-ринги',
      'Дискуссионные клубы и круглые столы',
      'Совместные выезды (слёты, школы, выездные школы актива)',
      'Экскурсии на предприятия и в организации-партнёры',
      'Экскурсии по городу и музеям',
      'Мероприятия по сохранению исторической памяти (встречи, акции, возложение цветов)',
      'Совместное участие в городских и районных мероприятиях',
      'Совместное участие в региональных и федеральных мероприятиях',
      'Другое: универсальное мероприятие воспитательной направленности (тематика не уточнена)',
    ];

    const curatorPersonalEventDirectionOptions = [
      'Организационно-методическое собрание кураторов',
      'Совещание по вопросам воспитательной работы',
      'Совещание по вопросам успеваемости и дисциплины студентов',
      'Инструктивное совещание по подготовке отчётности кураторов',
      'Совещание по работе с первокурсниками и адаптации обучающихся',
      'Совещание по профилактике правонарушений и асоциального поведения',
      'Совещание по профилактике экстремизма и терроризма',
      'Совещание по организации патриотических и памятных мероприятий',
      'Совещание по организации культурно-досуговой деятельности',
      'Совещание по организации спортивно-оздоровительной работы',
      'Совещание по работе со студентами, проживающими в общежитии',
      'Совещание по работе со студенческим самоуправлением',
      'Совещание по взаимодействию с родителями (законными представителями) студентов',
      'Методическое собрание по планированию воспитательной работы',
      'Методическое объединение кураторов',
      'Методический семинар по обмену опытом кураторской деятельности',
      'Семинар по организации индивидуальной работы со студентами',
      'Семинар по сопровождению студентов группы риска',
      'Семинар по работе со студентами с ОВЗ и особыми образовательными потребностями',
      'Семинар по работе с иностранными студентами',
      'Семинар по формированию благоприятного психологического климата в группе',
      'Семинар по формированию корпоративной культуры вуза',
      'Тренинг по развитию коммуникативных навыков куратора',
      'Тренинг по конфликтологии и медиации',
      'Тренинг по профилактике эмоционального выгорания куратора',
      'Тренинг по работе с тревожными и депрессивными студентами',
      'Тренинг по навыкам публичного выступления и ведения собраний',
      'Тренинг по использованию цифровых сервисов в работе куратора',
      'Тренинг по работе с документацией и отчётностью куратора',
      'Мастер-класс по проведению кураторского часа',
      'Мастер-класс по организации командообразующих мероприятий',
      'Мастер-класс по использованию интерактивных форм работы со студентами',
      'Мастер-класс по проектной деятельности со студенческой группой',
      'Мастер-класс по сопровождению участия студентов в конкурсах и форумах',
      'Мастер-класс по ведению официальных групп и чатов академической группы',
      'Участие в конкурсе профессионального мастерства кураторов',
      'Участие в конкурсе кураторских практик и воспитательных проектов',
      'Участие в городском/региональном конкурсе кураторов',
      'Участие в вузовском конкурсе «Лучший куратор»',
      'Участие в форуме/конференции по молодежной политике и воспитательной работе',
      'Участие в школе кураторов/школе классных руководителей',
      'Участие в стратегической сессии по развитию воспитательной работы в вузе',
      'Участие в круглом столе по вопросам молодежной политики',
      'Участие в круглых столах и дискуссионных площадках для кураторов',
      'Консультационное совещание с администрацией факультета/института',
      'Консультационное совещание с психологической службой вуза',
      'Другое: мероприятие общего характера для кураторов (тематика не уточнена)',
    ];

    const personalProgramDirectionOptions = [
      'Государственная молодежная политика',
      'Воспитательная работа в образовательных организациях',
      'Развитие системы кураторства и наставничества',
      'Гражданско-патриотическое воспитание детей и молодежи',
      'Историко-культурное и краеведческое воспитание',
      'Духовно-нравственное воспитание',
      'Формирование ценностей и гражданской идентичности молодежи',
      'Развитие студенческого самоуправления и органов ученического/студенческого управления',
      'Лидерские программы и школы актива',
      'Подготовка и поддержка молодежных лидеров',
      'Волонтерство и добровольческая деятельность',
      'Социальное служение и благотворительные проекты',
      'Социальное проектирование и молодежные социальные инициативы',
      'Экологические акции и проекты («зеленые» инициативы)',
      'Профилактика асоциального и девиантного поведения',
      'Профилактика правонарушений среди несовершеннолетних и молодежи',
      'Профилактика экстремизма и терроризма в молодежной среде',
      'Профилактика буллинга и кибербуллинга',
      'Формирование культуры безопасного поведения в сети',
      'Медиаобразование и медиаграмотность молодежи',
      'Программы по формированию здорового образа жизни',
      'Спортивно-оздоровительная деятельность с детьми и молодежью',
      'Профилактика зависимостей (ПАВ, алкоголь, табак, гаджеты и др.)',
      'Психологическое благополучие и поддержка ментального здоровья',
      'Профилактика эмоционального выгорания и стресса у молодежи',
      'Развитие коммуникативных навыков и культуры общения',
      'Развитие soft skills и универсальных компетенций',
      'Межкультурное взаимодействие и работа с многонациональной молодежью',
      'Интеграция иностранных студентов и мигрантов',
      'Формирование толерантности и культуры межнационального общения',
      'Инклюзивные практики и работа с молодежью с ОВЗ',
      'Рабочие смены и программы в детских центрах и лагерях',
      'Детско-юношеское и студенческое творчество и культурно-досуговые программы',
      'Творческие конкурсы, фестивали и смотры (театр, музыка, танец, ИКТ, дизайн и др.)',
      'Студенческие медиа, блогерство и контент для молодежной аудитории',
      'Патриотические форумы и слеты молодежи',
      'Городские и региональные молодежные форумы',
      'Всероссийские молодежные форумы и смены',
      'Конкурсы профессионального мастерства кураторов и педагогов',
      'Конкурсы по воспитательной работе и молодежной политике',
      'Конкурсы студенческих и молодежных проектов',
      'Конкурсы волонтерских и социальных инициатив',
      'Программы развития молодежного предпринимательства',
      'Профориентационные программы и мероприятия',
      'Карьерные форумы и ярмарки вакансий для молодежи',
      'Программы финансовой грамотности для детей и молодежи',
      'Образовательные интенсивы и школы по работе с молодежью',
      'Семинары и тренинги для специалистов по воспитательной работе',
      'Взаимодействие с молодежными общественными объединениями и движениями',
      'Взаимодействие с ресурсными молодежными центрами и Домами молодежи',
      'Участие в советах, рабочих группах и экспертных сессиях по молодежной политике',
      'Другое участие в программах и мероприятиях по работе с детьми и молодежью (указать направление в комментарии)',
    ];

    const mentorSupportDirectionOptions = [
      'Научно-исследовательские проекты студентов',
      'Учебно-исследовательские проекты и НИР',
      'Инженерные и конструкторские проекты',
      'IT-проекты и программная разработка',
      'Робототехника и техническое творчество',
      'Проекты в области аэрокосмических технологий',
      'Проекты в сфере цифровой экономики и цифровой трансформации',
      'Стартап-проекты и предпринимательские инициативы',
      'Социальное проектирование и социальные инициативы',
      'Проекты в сфере молодежной политики',
      'Проекты в области воспитательной деятельности и формирования ценностей',
      'Волонтёрские и благотворительные проекты',
      'Экологические проекты и «зелёные» инициативы',
      'Проекты по развитию студенческого самоуправления',
      'Культурно-творческие проекты и фестивали',
      'Медиа-проекты, SMM и студенческая журналистика',
      'Образовательные и просветительские проекты',
      'Профориентационные проекты',
      'Карьерные и тьюторские проекты',
      'Инклюзивные проекты и работа со студентами с ОВЗ',
      'Международные и межкультурные проекты',
      'Подготовка к научным и научно-практическим конференциям',
      'Подготовка к предметным и профессиональным олимпиадам',
      'Подготовка к чемпионатам по профессиональному мастерству',
      'Подготовка к инженерным и технологическим чемпионатам',
      'Подготовка к кейс-чемпионатам',
      'Подготовка к хакатонам и IT-соревнованиям',
      'Подготовка к конкурсам проектов и грантов',
      'Подготовка к конкурсам научных работ',
      'Подготовка к конкурсам студенческих стартапов',
      'Подготовка к творческим конкурсам и фестивалям',
      'Подготовка к конкурсам медиа-контента и блогерства',
      'Подготовка к спортивным соревнованиям и спартакиадам',
      'Подготовка к конкурсам лидерских и управленческих компетенций',
      'Подготовка к конкурсам студенческого самоуправления',
      'Подготовка к конкурсам добровольческих инициатив',
      'Наставничество в написании докладов и тезисов',
      'Наставничество в подготовке презентаций и публичных выступлений',
      'Наставничество в оформлении заявок на конкурсы и гранты',
      'Наставничество в планировании и управлении проектом',
      'Наставничество в командной работе и распределении ролей',
      'Наставничество в развитии soft skills участников команды',
      'Наставничество в развитии лидерских качеств студентов',
      'Наставничество в области научной этики и академической честности',
      'Организационное сопровождение участия студентов в мероприятиях',
      'Информационное сопровождение и мотивация студентов к участию',
      'Координация взаимодействия студентов с организаторами мероприятий',
      'Сопровождение студентов на этапах подготовки, участия и пост-анализа',
      'Обобщение и трансляция лучшего опыта участия в проектах и конкурсах',
      'Другое: наставничество и подготовка к мероприятиям иной направленности (указать в комментарии)',
    ];

    const mediaMaterialDirectionOptions = [
      'Интервью с кураторами академических групп',
      'Интервью со старостами и активом группы',
      'Интервью с успешными студентами',
      'Интервью с победителями олимпиад и конкурсов',
      'Интервью с участниками научно-исследовательских проектов',
      'Интервью с молодыми преподавателями и наставниками',
      'Интервью с выпускниками, добившимися профессиональных успехов',
      'Интервью с представителями работодателей и индустриальными партнёрами',
      'Истории успеха студентов ГУАП',
      'Профили академических групп и их традиций',
      'Адаптация первокурсников: опыт студентов и кураторов',
      'Статьи о студенческой научно-исследовательской деятельности',
      'Статьи о студенческих стартапах и предпринимательских проектах',
      'Статьи о проектной деятельности и кейс-чемпионатах',
      'Статьи о волонтёрской деятельности и добровольческих акциях',
      'Материалы о гражданско-патриотических проектах студентов',
      'Статьи о культурно-массовых мероприятиях в ГУАП',
      'Освещение спортивных достижений студентов',
      'Статьи о творческих коллективах и студенческих клубах',
      'Публикации о работе студенческого самоуправления',
      'Цикл материалов о жизни в общежитии',
      'Статьи о ментальном здоровье и благополучии студентов',
      'Публикации о профилактике выгорания у студентов',
      'Статьи о работе психологической службы ГУАП',
      'Материалы о развитии soft skills у студентов',
      'Статьи о карьерном развитии и профориентации',
      'Интервью с участниками стажировок и практик',
      'Публикации об академической мобильности и обменах',
      'Материалы о международных студентах и межкультурном диалоге',
      'Статьи о студенческих инициативах и самореализации',
      'Освещение ключевых университетских событий глазами студентов',
      'Репортажи с конференций, форумов и хакатонов',
      'Публикации о цифровых образовательных технологиях в ГУАП',
      'Материалы о развитии инженерных и ИТ-направлений',
      'Статьи об участии студентов в грантовых и конкурсных программах',
      'Публикации о вовлечении студентов в работу научных лабораторий',
      'Статьи об инклюзивной среде и поддержке студентов с ОВЗ',
      'Материалы о благотворительных и социальных проектах',
      'Публикации о студенческих инициативах в сфере экологии',
      'Статьи о финансовой грамотности и экономической культуре студентов',
      'Материалы о правовой грамотности и правах студентов',
      'Истории личностного роста и преодоления трудностей',
      'Интервью о балансе учёбы, работы и личной жизни',
      'Статьи о лучших практиках кураторской работы',
      'Публикации о взаимодействии кураторов с родителями студентов',
      'Освещение внутригрупповых мероприятий и тимбилдингов',
      'Материалы о формировании корпоративной культуры ГУАП',
      'Статьи о медиа- и цифровой грамотности студентов',
      'Публикации о безопасном и ответственном поведении в сети',
      'Цикл материалов “Один день из жизни студента ГУАП”',
      'Цикл материалов “Один день из жизни куратора”',
      'Статьи о традициях и истории ГУАП',
      'Публикации о развитии студенческих медиа и блогерства',
      'Материалы о взаимодействии ГУАП с городским и региональным сообществом',
      'Статьи о роли кураторов в воспитательной деятельности',
      'Публикации о лучших практиках организации свободного времени студентов',
      'Материалы о вовлечении студентов в управление университетом',
      'Статьи об участии студентов в городских и всероссийских молодежных мероприятиях',
      'Публикации о профессиональных сообществах и ассоциациях, в которые входят студенты и выпускники ГУАП',
      'Другое: материал иной направленности',
    ];

    function buildNormalizedSet(values = []) {
      return new Set(values.map((value) => value.trim().toLowerCase()).filter(Boolean));
    }

    const jobPositionOptionsNormalized = buildNormalizedSet(jobPositionOptions);
    const departmentOptionsNormalized = buildNormalizedSet(
      Array.from(document.getElementById('department-options')?.querySelectorAll('option') || []).map(
        (option) => option.value
      )
    );
    const primaryRoomOptionsNormalized = buildNormalizedSet(
      Array.from(document.getElementById('curator-primary-room-options')?.querySelectorAll('option') || []).map(
        (option) => option.value
      )
    );
    const primaryBuildingOptionsNormalized = buildNormalizedSet(
      Array.from(form.elements.curator_primary_building?.options || []).map((option) => option.value)
    );

    let jobPositionsSelect;

    function selectReportingPeriod(period) {
      if (!period) {
        setManualReportingPeriod();
        return;
      }

      const { label = '', date_start: dateStart = '', date_end: dateEnd = '', deadline = '' } = period;
      const { start: rangeStart, end: rangeEnd } = splitRange(period.range || '');
      const normalizedStart = dateStart || rangeStart;
      const normalizedEnd = dateEnd || rangeEnd;

      setManualReportingPeriod({ label, dateStart: normalizedStart, dateEnd: normalizedEnd, deadline });
    }

    const fieldComments = {
      reporting_period: 'Выбранный отчётный период и крайний срок отправки отчёта.',
      _meta: 'Комментарии добавлены для ориентира и не влияют на валидацию данных.',
      full_name: 'Фамилия Имя Отчество куратора.',
      job_positions: 'Список должностей куратора; выберите подходящие варианты через поиск.',
      department: 'Кафедра или структурное подразделение, в котором работает куратор.',
      contact_phone_connected_to_telegram: 'Контактный телефон, привязанный к аккаунту Telegram.',
      telegram_username: 'Никнейм в Telegram, начиная с @.',
      email: 'Рабочий адрес электронной почты.',
      curated_group_numbers: 'Номера групп, с которыми куратор работает в отчётном периоде.',
      curator_primary_building: 'Корпус основного пребывания куратора.',
      curator_primary_room: 'Аудитория (кабинет), в которой куратор чаще всего находится.',
      institute_or_faculty: 'Институты или факультеты, закреплённые за куратором.',
      held_minimum_three_curator_sessions_in_reporting_period:
        'Отметьте, проведены ли минимум три кураторских часа в отчётный период.',
      curator_hours_details: {
        _comment: 'Детализация проведённых кураторских часов.',
        groups: 'Группы, участвовавшие в занятии (список).',
        specialists: 'Приглашённые специалисты (список).',
        date_start: 'Дата начала или единственная дата занятия.',
        date_end: 'Дата окончания, если занятие длилось несколько дней.',
        topic: 'Тема кураторского часа.',
        directions: 'Направления воспитательной работы, раскрытые на занятии.',
      },
      inform_group_about_events: 'Куратор информирует обучающихся о мероприятиях для участия.',
      achievements: {
        _comment: 'Достижения обучающихся и групп.',
        date_start: 'Дата начала или единственная дата достижения.',
        date_end: 'Дата окончания, если достижение относится к периоду.',
        event: 'Название или описание мероприятия/конкурса.',
        directions: 'Направленность достижения из перечня по вопросу 15.',
        group: 'Номер группы, к которой относится достижение.',
        student: 'ФИО студента или студентов.',
        result: 'Полученный результат: место, статус, грант и т.д.',
      },
      manages_group_chat: 'Куратор администрирует чат или ведёт переписку с группой.',
      participated_in_two_events_with_group: 'Куратор посетил минимум два мероприятия вместе с группой.',
      joint_participation_events: {
        _comment: 'Совместные мероприятия с участием куратора и группы.',
        groups: 'Группы-участники мероприятия (список).',
        date_start: 'Дата начала или основная дата мероприятия.',
        date_end: 'Дата окончания, если мероприятие длилось несколько дней.',
        event: 'Краткое описание или название мероприятия.',
        directions: 'Направленность мероприятия из перечня по вопросу 17.',
      },
      participated_in_two_curator_events: 'Куратор принял участие минимум в двух мероприятиях для кураторов.',
      curator_personal_events: {
        _comment: 'Сведения о личном участии куратора в программах, форумах и конкурсах.',
        date_start: 'Дата начала или единственная дата участия.',
        date_end: 'Дата окончания периода участия, если применимо.',
        event: 'Название или описание мероприятия.',
        directions: 'Направленность мероприятия из списка по вопросу 19.',
      },
      personal_program_participation: {
        _comment:
          'Участие куратора в программах, конкурсах и мероприятиях по работе с молодежью на региональном и федеральном уровнях.',
        date_start: 'Дата начала или единственная дата участия.',
        date_end: 'Дата окончания участия, если мероприятие длилось несколько дней.',
        event: 'Название или описание программы, конкурса или мероприятия.',
        directions: 'Направленности участия из списка по вопросу 20.',
      },
      mentor_support_events: {
        _comment:
          'Наставничество куратора в проектах и подготовке к чемпионатам, конкурсам, конференциям и другим мероприятиям.',
        date_start: 'Дата начала или единственная дата наставничества.',
        date_end: 'Дата окончания, если наставничество длилось несколько дней.',
        event: 'Название мероприятия или проекта.',
        directions: 'Направленность наставничества согласно перечню по вопросу 21.',
        group: 'Группа, с которой работал куратор.',
        student: 'ФИО студента или команды.',
        result: 'Результат участия: итог, статус, достижение.',
      },
      scientific_publications: {
        _comment:
          'Сведения об опубликованных научных работах по молодежной политике и воспитательной деятельности с указанием принадлежности к ГУАП.',
        description: 'Вводные данные о публикации: название, тип, соавторы, выходные данные.',
        link: 'Ссылка на интернет-ресурс с опубликованной работой или электронным изданием.',
        directions: 'Направленность публикации из списка по вопросу 22.',
      },
      media_materials: {
        _comment: 'Интервью и статьи, подготовленные для «Дзен.ГУАП», соцсетей и сайта ГУАП.',
        link: 'Ссылка на опубликованный материал.',
        directions: 'Направленность материала согласно перечню по вопросу 23.',
      },
      qualification_courses: {
        _comment: 'Данные о курсах повышения квалификации в области молодежной политики и воспитательной деятельности.',
        date_start: 'Дата начала или единственная дата обучения.',
        date_end: 'Дата окончания курса, если обучение шло периодом.',
        event: 'Название или описание курса.',
        directions: 'Направленности курса из списка по вопросу 24.',
      },
    };

    function closeAllTooltips(except = null) {
      document.querySelectorAll('.tooltip.tooltip--active').forEach((tooltip) => {
        if (tooltip === except) return;
        const trigger = tooltip.querySelector('.tooltip__trigger');
        tooltip.classList.remove('tooltip--active');
        if (trigger) {
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
    }

    function createAchievementRow() {
      const row = document.createElement('div');
      row.className = 'achievement-row';
      const directionDropdownId = `achievement-directions-list-${++achievementDirectionDropdownId}`;
      const directionLabelId = `achievement-direction-label-${achievementDirectionDropdownId}`;

      row.innerHTML = `
        <div class="achievement-grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата либо период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="achievement-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="achievement-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea name="achievement_event" placeholder="Например, участие в городском конкурсе проектов"></textarea>
          </label>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей достижения"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность достижения из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="achievement_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="achievement_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Группа</span>
            <input type="text" name="achievement_group" placeholder="Например, 4102" />
          </label>
          <label class="field field--compact">
            <span class="field__label">ФИО студента</span>
            <input type="text" name="achievement_student" placeholder="Например, Петрова Анна Сергеевна" />
          </label>
          <label class="field field--compact">
            <span class="field__label">Итог</span>
            <textarea name="achievement_result" placeholder="Например, 2 место, грант на разработку проекта"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove achievement-row__remove" aria-label="Удалить запись">&times;</button>
      `;

      const removeButton = row.querySelector('.achievement-row__remove');
      removeButton.addEventListener('click', () => row.remove());

      return row;
    }

    function addAchievementRow() {
      const row = createAchievementRow();
      achievementRowsContainer.prepend(row);

      const directionSelect = setupSearchableMultiSelect({
        name: 'achievement_directions',
        options: achievementDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="achievement_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        achievementDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createMentorSupportRow() {
      const row = document.createElement('div');
      row.className = 'achievement-row';
      const directionDropdownId = `mentor-support-directions-list-${++mentorSupportDirectionDropdownId}`;
      const directionLabelId = `mentor-support-direction-label-${mentorSupportDirectionDropdownId}`;

      row.innerHTML = `
        <div class="achievement-grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата либо период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="mentor-support-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="mentor-support-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea name="mentor_support_event" placeholder="Например, подготовка к конференции или чемпионату"></textarea>
          </label>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей наставничества"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность наставничества из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="mentor_support_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность наставничества"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="mentor_support_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Группа</span>
            <input type="text" name="mentor_support_group" placeholder="Например, 4102" />
          </label>
          <label class="field field--compact">
            <span class="field__label">ФИО студента</span>
            <input type="text" name="mentor_support_student" placeholder="Например, Иванова Елена Петровна" />
          </label>
          <label class="field field--compact">
            <span class="field__label">Итог</span>
            <textarea name="mentor_support_result" placeholder="Например, вышли в финал конкурса"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove achievement-row__remove" aria-label="Удалить запись">&times;</button>
      `;

      const removeButton = row.querySelector('.achievement-row__remove');
      removeButton.addEventListener('click', () => row.remove());

      return row;
    }

    function addMentorSupportRow() {
      const row = createMentorSupportRow();
      mentorSupportRowsContainer?.prepend(row);

      const directionSelect = setupSearchableMultiSelect({
        name: 'mentor_support_directions',
        options: mentorSupportDirectionOptions,
        placeholder: 'Начните вводить направленность наставничества',
        container: row.querySelector('[data-name="mentor_support_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        mentorSupportDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createJointEventRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'joint-events__row';
      const directionDropdownId = `joint-event-directions-list-${++jointEventDirectionDropdownId}`;
      const directionLabelId = `joint-event-direction-label-${jointEventDirectionDropdownId}`;

      row.innerHTML = `
        <div class="joint-events__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Группы</span>
              <button
                type="button"
                class="chip chip--interactive curator-hours__add-item joint-events__add-item"
                data-target="groups"
              >
                Добавить
              </button>
            </div>
            <div class="multi-input" data-list="groups"></div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="joint-events-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="joint-events-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей мероприятия"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Укажите направленность мероприятия из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="joint_event_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="joint_event_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятия</span>
            <textarea name="joint_event_description" placeholder="Например, участие в двух выставках"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove joint-events__row-remove" aria-label="Удалить запись">&times;</button>
      `;

      const listContainer = row.querySelector('[data-list="groups"]');
      const addButton = row.querySelector('.joint-events__add-item[data-target="groups"]');

      if (listContainer && addButton) {
        setupRowList({ row, target: 'groups', placeholder: 'Например, 4102', startEmpty: true, minRows: 0 });
      }

      const removeButton = row.querySelector('.joint-events__row-remove');

      if (removeButton) {
        if (!isRemovable) {
          removeButton.disabled = true;
          removeButton.setAttribute('aria-disabled', 'true');
        } else {
          removeButton.addEventListener('click', () => row.remove());
        }
      }

      return row;
    }

    function addJointEventRow({ isRemovable = true } = {}) {
      const row = createJointEventRow({ isRemovable });

      const directionSelect = setupSearchableMultiSelect({
        name: 'joint_event_directions',
        options: jointEventDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="joint_event_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        jointEventDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createExtracurricularRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'curator-hours__row extracurricular-row';
      const directionDropdownId = `curator-personal-directions-list-${++curatorPersonalEventDirectionDropdownId}`;
      const directionLabelId = `curator-personal-direction-label-${curatorPersonalEventDirectionDropdownId}`;

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="extracurricular-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="extracurricular-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей мероприятия"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность мероприятия из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="curator_personal_event_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="curator_personal_event_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea class="extracurricular-event__description" placeholder="Например, участие в форуме наставников" rows="3"></textarea>
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove extracurricular-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.extracurricular-row__remove');

      if (removeButton) {
        if (!isRemovable) {
          removeButton.disabled = true;
          removeButton.setAttribute('aria-disabled', 'true');
          removeButton.dataset.fixed = 'true';
        } else {
          removeButton.addEventListener('click', () => row.remove());
        }
      }

      return row;
    }

    function updateExtracurricularRowRemovalState() {
      const rows = extracurricularRowsContainer.querySelectorAll('.extracurricular-row');
      rows.forEach((row) => {
        const removeButton = row.querySelector('.extracurricular-row__remove');
        if (!removeButton) return;
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
          return;
        }
        removeButton.disabled = rows.length === 1;
      });
    }

    function addExtracurricularRow(options = {}) {
      const row = createExtracurricularRow(options);
      const removeButton = row.querySelector('.extracurricular-row__remove');

      const directionSelect = setupSearchableMultiSelect({
        name: 'curator_personal_event_directions',
        options: curatorPersonalEventDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="curator_personal_event_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        curatorPersonalEventDirectionSelects.set(row, directionSelect);
      }

      if (removeButton && !removeButton.dataset.fixed) {
        removeButton.addEventListener('click', () => {
          if (extracurricularRowsContainer.querySelectorAll('.extracurricular-row').length === 1) return;
          row.remove();
          updateExtracurricularRowRemovalState();
        });
      }

      extracurricularRowsContainer.prepend(row);
      setupTooltips();
      updateExtracurricularRowRemovalState();

      return row;
    }

    function createPersonalProgramRow() {
      const row = document.createElement('div');
      row.className = 'curator-hours__row personal-program-row';
      const directionDropdownId = `personal-program-directions-list-${++personalProgramDirectionDropdownId}`;
      const directionLabelId = `personal-program-direction-label-${personalProgramDirectionDropdownId}`;

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="personal-program-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="personal-program-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей участия"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность участия из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="personal_program_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="personal_program_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea class="personal-program-event__description" placeholder="Например, участие в форуме «Голос поколения»" rows="3"></textarea>
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove personal-program-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.personal-program-row__remove');
      if (removeButton) {
        removeButton.addEventListener('click', () => row.remove());
      }

      return row;
    }

    function addPersonalProgramRow() {
      const row = createPersonalProgramRow();
      personalProgramRowsContainer.prepend(row);
      const directionSelect = setupSearchableMultiSelect({
        name: 'personal_program_directions',
        options: personalProgramDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="personal_program_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        personalProgramDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createScientificWorkRow() {
      const row = document.createElement('div');
      row.className = 'curator-hours__row scientific-work-row';
      const directionDropdownId = `scientific-work-directions-list-${++scientificWorkDirectionDropdownId}`;
      const directionLabelId = `scientific-work-direction-label-${scientificWorkDirectionDropdownId}`;

      row.innerHTML = `
        <div class="curator-hours__grid">
          <label class="field field--compact">
            <span class="field__label">Вводные данные</span>
            <textarea class="scientific-work__description" placeholder="Например, монография или статья с указанием издания и соавторов" rows="3"></textarea>
          </label>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей публикации"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность публикации из списка или добавьте несколько вариантов. Чтобы удалить выбранное,
                  нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="scientific_work_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="scientific_work_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Ссылка на интернет-ресурс</span>
            <input type="url" class="scientific-work__link" placeholder="https://example.com" />
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove scientific-work-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.scientific-work-row__remove');
      if (removeButton) {
        removeButton.addEventListener('click', () => row.remove());
      }

      return row;
    }

    function addScientificWorkRow() {
      const row = createScientificWorkRow();
      scientificWorkRowsContainer.prepend(row);

      const directionSelect = setupSearchableMultiSelect({
        name: 'scientific_work_directions',
        options: scientificWorkDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="scientific_work_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        scientificWorkDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createInterviewRow() {
      const row = document.createElement('div');
      row.className = 'curator-hours__row interview-row';
      const directionDropdownId = `media-material-directions-list-${++interviewDirectionDropdownId}`;
      const directionLabelId = `media-material-direction-label-${interviewDirectionDropdownId}`;

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей материала"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность материала из списка или добавьте несколько вариантов. Чтобы удалить выбранное, нажмите
                  на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="media_material_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="media_material_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Ссылка на интернет-ресурс</span>
            <input type="url" class="interview__link" placeholder="https://example.com/material" />
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove interview-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.interview-row__remove');
      if (removeButton) {
        removeButton.addEventListener('click', () => row.remove());
      }

      return row;
    }

    function addInterviewRow() {
      const row = createInterviewRow();
      interviewRowsContainer.prepend(row);

      const directionSelect = setupSearchableMultiSelect({
        name: 'media_material_directions',
        options: mediaMaterialDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="media_material_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        interviewDirectionSelects.set(row, directionSelect);
      }

      setupTooltips();

      return row;
    }

    function createQualificationCourseRow() {
      const row = document.createElement('div');
      row.className = 'curator-hours__row qualification-course-row';
      const directionDropdownId = `qualification-course-directions-list-${++qualificationCourseDirectionDropdownId}`;
      const directionLabelId = `qualification-course-direction-label-${qualificationCourseDirectionDropdownId}`;

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (Дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="qualification-course-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="qualification-course-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей курса"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите направленность курса из списка или добавьте несколько вариантов. Чтобы удалить выбранное, нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="qualification_course_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="qualification_course_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea class="qualification-course__description" placeholder="Например, курс повышения квалификации по молодежной политике" rows="3"></textarea>
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove qualification-course-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.qualification-course-row__remove');
      if (removeButton) {
        removeButton.addEventListener('click', () => row.remove());
      }

      return row;
    }

    function addQualificationCourseRow() {
      const row = createQualificationCourseRow();
      qualificationCourseRowsContainer.prepend(row);
      const directionSelect = setupSearchableMultiSelect({
        name: 'qualification_course_directions',
        options: qualificationCourseDirectionOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="qualification_course_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        qualificationCourseDirectionSelects.set(row, directionSelect);
      }
      setupTooltips();

      return row;
    }

    let tooltipListenersAttached = false;

    function updateTooltipPosition(tooltip) {
      const bubble = tooltip.querySelector('.tooltip__bubble');

      if (!bubble) return;

      bubble.style.setProperty('--tooltip-shift', '0px');

      const rect = bubble.getBoundingClientRect();
      const padding = 12;
      const overflowLeft = padding - rect.left;
      const overflowRight = rect.right - (window.innerWidth - padding);
      let shift = 0;

      if (overflowLeft > 0) {
        shift += overflowLeft;
      }

      if (overflowRight > 0) {
        shift -= overflowRight;
      }

      if (shift !== 0) {
        bubble.style.setProperty('--tooltip-shift', `${shift}px`);
      }
    }

    function setupTooltips() {
      const triggers = document.querySelectorAll('.tooltip__trigger');

      triggers.forEach((trigger) => {
        if (trigger.dataset.tooltipReady) return;

        const tooltip = trigger.closest('.tooltip');
        if (!tooltip) return;

        trigger.dataset.tooltipReady = 'true';

        const openAndUpdate = () => {
          if (tooltip.classList.contains('tooltip--active')) return;

          closeAllTooltips(tooltip);
          tooltip.classList.add('tooltip--active');
          trigger.setAttribute('aria-expanded', 'true');
          requestAnimationFrame(() => updateTooltipPosition(tooltip));
        };

        trigger.addEventListener('click', (event) => {
          event.stopPropagation();
          const isActive = tooltip.classList.toggle('tooltip--active');
          trigger.setAttribute('aria-expanded', String(isActive));

          if (isActive) {
            closeAllTooltips(tooltip);
            requestAnimationFrame(() => updateTooltipPosition(tooltip));
          }
        });

        trigger.addEventListener('mouseenter', openAndUpdate);
        trigger.addEventListener('focus', openAndUpdate);

        trigger.addEventListener('blur', () => {
          setTimeout(() => {
            if (!tooltip.contains(document.activeElement)) {
              tooltip.classList.remove('tooltip--active');
              trigger.setAttribute('aria-expanded', 'false');
            }
          }, 120);
        });
      });

      if (!tooltipListenersAttached) {
        tooltipListenersAttached = true;

        document.addEventListener('click', (event) => {
          if (event.target.closest('.tooltip')) return;
          closeAllTooltips();
        });

        window.addEventListener('resize', () => {
          requestAnimationFrame(() => {
            document.querySelectorAll('.tooltip.tooltip--active').forEach(updateTooltipPosition);
          });
        });
      }
    }

    function createRow(inputName, placeholder = '') {
      const row = document.createElement('div');
      row.className = 'multi-input__row';

      const input = document.createElement('input');
      input.type = 'text';
      input.name = inputName;
      input.required = true;
      input.placeholder = placeholder;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'multi-input__remove';
      removeButton.setAttribute('aria-label', 'Удалить запись');
      removeButton.textContent = '×';

      row.append(input, removeButton);
      return row;
    }

    function setupMultiInput({ name, inputName, placeholder = '', minRows = 1 }) {
      const container = form.querySelector(`[data-name="${name}"]`);
      const addButton = form.querySelector(`[data-add="${name}"]`);

      if (!container || !addButton) return;

      function updateRemoveState() {
        const rows = container.querySelectorAll('.multi-input__row');
        rows.forEach((row) => {
          const removeButton = row.querySelector('.multi-input__remove');
          if (!removeButton) return;
          const isDisabled = rows.length <= minRows;
          removeButton.disabled = isDisabled;
        });
      }

      function attachRemove(row) {
        const removeButton = row.querySelector('.multi-input__remove');
        if (!removeButton) return;
        removeButton.addEventListener('click', () => {
          if (container.querySelectorAll('.multi-input__row').length <= minRows) return;
          row.remove();
          updateRemoveState();
        });
      }

      function ensureMinimumRows() {
        while (container.querySelectorAll('.multi-input__row').length < minRows) {
          const newRow = createRow(inputName, placeholder);
          attachRemove(newRow);
          container.prepend(newRow);
        }
      }

      container.querySelectorAll('.multi-input__row').forEach((row) => attachRemove(row));

      ensureMinimumRows();

      addButton.addEventListener('click', () => {
        const newRow = createRow(inputName, placeholder);
        attachRemove(newRow);
        container.prepend(newRow);
        updateRemoveState();
      });

      updateRemoveState();
    }

    function collectFaculties() {
      return Array.from(form.querySelectorAll('input[name="institute_or_faculty"]:checked')).map((input) => input.value);
    }

    function getBooleanRadio(name) {
      const selected = form.querySelector(`input[name="${name}"]:checked`);
      if (!selected) return null;
      return selected.value === 'true';
    }

    function getSelectedRadio(name) {
      const selected = form.querySelector(`input[name="${name}"]:checked`);
      return selected ? selected.value : '';
    }

    function sanitizeText(value = '') {
      return value.replace(/\s*\n\s*/g, ' ').trim();
    }

    function getValue(name) {
      return sanitizeText(form.elements[name]?.value || '');
    }

    function collectList(name) {
      const container = form.querySelector(`[data-name="${name}"]`);
      if (!container) return [];
      const collectableInputs = container.querySelectorAll('input[data-collect]');
      const inputs = collectableInputs.length ? collectableInputs : container.querySelectorAll('input');

      return Array.from(inputs)
        .map((input) => sanitizeText(input.value))
        .filter(Boolean);
    }

    function createListRow(placeholder = '') {
      const row = document.createElement('div');
      row.className = 'multi-input__row';

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = placeholder;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'multi-input__remove';
      removeButton.setAttribute('aria-label', 'Удалить запись');
      removeButton.textContent = '×';

      row.append(input, removeButton);
      return row;
    }

    function setRadioValue(name, value) {
      const inputs = form.querySelectorAll(`input[name="${name}"]`);
      if (!inputs.length) return;

      if (value === null || value === undefined) {
        inputs.forEach((input) => {
          input.checked = false;
        });
        return;
      }

      const normalized = typeof value === 'boolean' ? String(value) : value;
      const target = form.querySelector(`input[name="${name}"][value="${normalized}"]`);

      inputs.forEach((input) => {
        input.checked = input === target;
      });

      if (target) {
        target.dispatchEvent(new Event('change', { bubbles: true }));
      }
    }

    function fillMultiInput(name, values = [], minRows = 1) {
      const container = form.querySelector(`[data-name="${name}"]`);
      const addButton = form.querySelector(`[data-add="${name}"]`);

      if (!container) return;

      const desiredLength = Math.max(values.length, minRows);
      while (container.querySelectorAll('.multi-input__row').length < desiredLength) {
        addButton?.click();
      }

      const inputs = container.querySelectorAll('input');
      inputs.forEach((input, index) => {
        input.value = values[index] ?? '';
      });

      const removeButtons = container.querySelectorAll('.multi-input__remove');
      const cutoff = values.length ? values.length : minRows;

      for (let i = removeButtons.length - 1; i >= cutoff; i -= 1) {
        const removeButton = removeButtons[i];
        if (removeButton && !removeButton.disabled) {
          removeButton.click();
        }
      }
    }

    function enhanceDatalistInput(input) {
      const listId = input?.getAttribute('list');
      if (!input || !listId) return;

      const datalist = document.getElementById(listId);
      if (!datalist) return;

      const options = Array.from(datalist.querySelectorAll('option'))
        .map((option) => option.value)
        .filter(Boolean);
      const normalizedOptions = new Set(options.map((option) => option.trim().toLowerCase()));

      const container = document.createElement('div');
      container.className = 'datalist';

      const control = document.createElement('div');
      control.className = 'datalist__control';

      const chevron = document.createElement('button');
      chevron.type = 'button';
      chevron.className = 'datalist__chevron';
      chevron.setAttribute('aria-label', 'Показать варианты');
      chevron.textContent = '▾';

      const dropdown = document.createElement('div');
      dropdown.className = 'datalist__dropdown';

      input.classList.add('datalist__input');
      input.removeAttribute('list');
      input.autocomplete = 'off';

      function closeDropdown() {
        dropdown.classList.remove('datalist__dropdown--open');
        container.classList.remove('datalist--open');
      }

      function renderOptions(term = '') {
        dropdown.innerHTML = '';
        const normalized = term.toLowerCase();
        const filtered = options.filter((option) => option.toLowerCase().includes(normalized));

        if (!filtered.length) {
          const empty = document.createElement('div');
          empty.className = 'datalist__option';
          empty.textContent = 'Совпадений не найдено';
          dropdown.append(empty);
          return;
        }

        filtered.forEach((option) => {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'datalist__option';
          button.textContent = option;
          button.addEventListener('click', () => {
            input.value = option;
            closeDropdown();
            input.dispatchEvent(new Event('input', { bubbles: true }));
          });
          dropdown.append(button);
        });
      }

      function openDropdown() {
        dropdown.classList.add('datalist__dropdown--open');
        container.classList.add('datalist--open');
        renderOptions(input.value.trim());
      }

      const parent = input.parentElement;
      parent.insertBefore(container, input);
      container.append(control);
      control.append(input, chevron);
      container.append(dropdown);
      datalist.hidden = true;
      container.append(datalist);

      input.addEventListener('focus', openDropdown);
      input.addEventListener('input', (event) => renderOptions(event.target.value.trim()));
      input.addEventListener('blur', () => {
        const pendingValue = input.value.trim();
        setTimeout(() => {
          const nextFocus = document.activeElement;

          if (nextFocus && container.contains(nextFocus)) {
            return;
          }

          if (pendingValue && !normalizedOptions.has(pendingValue.toLowerCase())) {
            input.value = '';
            input.dispatchEvent(new Event('input', { bubbles: true }));
          }

          closeDropdown();
        }, 0);
      });
      input.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeDropdown();
        }
      });

      chevron.addEventListener('click', () => {
        if (dropdown.classList.contains('datalist__dropdown--open')) {
          closeDropdown();
        } else {
          input.focus();
          openDropdown();
        }
      });

      document.addEventListener('click', (event) => {
        if (!container.contains(event.target)) {
          closeDropdown();
        }
      });

      renderOptions();
    }

    function addSelectBlurValidation(select) {
      if (!select) return;

      const allowedValues = Array.from(select.options).map((option) => option.value);
      const normalizedValues = new Set(allowedValues.map((value) => value.trim().toLowerCase()));
      select.addEventListener('blur', () => {
        const value = select.value;
        if (value && !normalizedValues.has(value.trim().toLowerCase())) {
          select.value = '';
          select.dispatchEvent(new Event('change', { bubbles: true }));
        }
      });
    }

    function enhanceSelectDropdown(select) {
      if (!select || select.dataset.enhanced === 'true') return;

      const shell = select.closest('.select-shell') || select.parentElement;
      if (!shell) return;

      const options = Array.from(select.options);
      const dropdown = document.createElement('div');
      dropdown.className = 'select-shell__dropdown';
      dropdown.setAttribute('role', 'listbox');

      const trigger = document.createElement('button');
      trigger.type = 'button';
      trigger.className = 'select-shell__display';
      trigger.setAttribute('aria-haspopup', 'listbox');
      trigger.setAttribute('aria-expanded', 'false');

      select.classList.add('select-shell__native');
      shell.classList.add('select-shell--enhanced');
      select.dataset.enhanced = 'true';

      function closeDropdown() {
        dropdown.classList.remove('select-shell__dropdown--open');
        trigger.setAttribute('aria-expanded', 'false');
        shell.classList.remove('select-shell--open');
      }

      function openDropdown() {
        dropdown.classList.add('select-shell__dropdown--open');
        trigger.setAttribute('aria-expanded', 'true');
        shell.classList.add('select-shell--open');
      }

      function syncTriggerLabel() {
        const selected = select.selectedOptions[0];
        trigger.textContent = selected?.textContent || select.options[0]?.textContent || '—';
      }

      function updateSelection(value) {
        select.value = value;
        select.dispatchEvent(new Event('change', { bubbles: true }));
        Array.from(dropdown.querySelectorAll('.select-shell__option')).forEach((optionButton) => {
          optionButton.setAttribute('aria-selected', optionButton.dataset.value === value ? 'true' : 'false');
        });
        syncTriggerLabel();
        closeDropdown();
        trigger.focus();
      }

      options.forEach((option) => {
        const optionButton = document.createElement('button');
        optionButton.type = 'button';
        optionButton.className = 'select-shell__option';
        optionButton.textContent = option.textContent;
        optionButton.dataset.value = option.value;
        optionButton.setAttribute('role', 'option');
        optionButton.setAttribute('aria-selected', option.selected && !option.disabled ? 'true' : 'false');

        if (option.disabled && !option.value) {
          optionButton.disabled = true;
        }

        optionButton.addEventListener('click', () => updateSelection(option.value));
        dropdown.append(optionButton);
      });

      trigger.addEventListener('click', () => {
        if (dropdown.classList.contains('select-shell__dropdown--open')) {
          closeDropdown();
        } else {
          openDropdown();
          const activeOption = dropdown.querySelector('[aria-selected="true"]:not(:disabled)');
          const fallbackOption = dropdown.querySelector('button:not(:disabled)');
          (activeOption || fallbackOption)?.focus();
        }
      });

      trigger.addEventListener('keydown', (event) => {
        if ([' ', 'Enter', 'ArrowDown', 'ArrowUp'].includes(event.key)) {
          event.preventDefault();
          openDropdown();
          const activeOption = dropdown.querySelector('[aria-selected="true"]:not(:disabled)');
          const fallbackOption = dropdown.querySelector('button:not(:disabled)');
          (activeOption || fallbackOption)?.focus();
        }
        if (event.key === 'Escape') {
          closeDropdown();
        }
      });

      dropdown.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          event.preventDefault();
          closeDropdown();
          trigger.focus();
        }
      });

      document.addEventListener('click', (event) => {
        if (!shell.contains(event.target)) {
          closeDropdown();
        }
      });

      select.insertAdjacentElement('afterend', dropdown);
      select.insertAdjacentElement('afterend', trigger);
      select.addEventListener('change', syncTriggerLabel);
      syncTriggerLabel();
    }

    function setupSearchableMultiSelect({
      name,
      options = [],
      placeholder = '',
      container: providedContainer = null,
      selectedContainer: providedSelectedContainer = null,
    }) {
      const container = providedContainer || form.querySelector(`[data-name="${name}"]`);
      if (!container) return null;

      const control = container.querySelector('.multi-select__control');
      const input = container.querySelector('.multi-select__input');
      const dropdown = container.querySelector('.multi-select__dropdown');
      const valuesContainer = providedSelectedContainer || container.querySelector('.multi-select__values');
      const hiddenContainer = container.querySelector('.multi-select__hidden');
      const validator = container.querySelector('.multi-select__validator');
      const chevron = container.querySelector('.multi-select__chevron');
      const selectionContainer = providedSelectedContainer;

      const selected = new Set();
      input.placeholder = placeholder;

      function updateValidator() {
        if (!validator) return;
        validator.value = selected.size ? 'selected' : '';
      }

      function updateHiddenInputs() {
        if (!hiddenContainer) return;
        hiddenContainer.innerHTML = '';

        if (!selected.size) {
          const placeholder = document.createElement('input');
          placeholder.type = 'hidden';
          placeholder.setAttribute('data-collect', 'true');
          hiddenContainer.append(placeholder);
          return;
        }

        selected.forEach((value) => {
          const hiddenInput = document.createElement('input');
          hiddenInput.type = 'hidden';
          hiddenInput.name = name;
          hiddenInput.value = value;
          hiddenInput.setAttribute('data-collect', 'true');
          hiddenContainer.append(hiddenInput);
        });
      }

      function renderSelected() {
        if (!valuesContainer) return;
        valuesContainer.innerHTML = '';

        selected.forEach((value) => {
          const chip = document.createElement('span');
          chip.className = 'multi-select__chip';
          chip.textContent = value;

          const removeButton = document.createElement('button');
          removeButton.type = 'button';
          removeButton.className = 'multi-select__chip-remove';
          removeButton.setAttribute('aria-label', `Удалить «${value}»`);
          removeButton.textContent = '×';
          removeButton.addEventListener('mousedown', (event) => {
            event.preventDefault();
            event.stopPropagation();
          });
          removeButton.addEventListener('click', (event) => {
            event.stopPropagation();
            selected.delete(value);
            renderSelected();
            updateHiddenInputs();
            updateValidator();
            renderOptions(input.value.trim());
          });

          chip.append(removeButton);
          valuesContainer.append(chip);
        });
      }

      function closeDropdown() {
        dropdown.classList.remove('multi-select__dropdown--open');
        control?.setAttribute('aria-expanded', 'false');
        container.classList.remove('multi-select--open');
      }

      function renderOptions(term = '') {
        dropdown.innerHTML = '';
        const normalized = term.toLowerCase();

        const filtered = options.filter((option) => {
          if (selected.has(option)) return false;
          return option.toLowerCase().includes(normalized);
        });

        if (!filtered.length) {
          const empty = document.createElement('div');
          empty.className = 'multi-select__option';
          empty.textContent = 'Совпадений не найдено';
          empty.setAttribute('aria-live', 'polite');
          dropdown.append(empty);
          return;
        }

        filtered.forEach((option) => {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'multi-select__option';
          button.setAttribute('role', 'option');
          button.textContent = option;
          button.addEventListener('click', () => {
            selected.add(option);
            input.value = '';
            renderSelected();
            updateHiddenInputs();
            updateValidator();
            renderOptions('');
            input.focus();
          });

          dropdown.append(button);
        });
      }

      const normalizedOptions = new Set(options.map((option) => option.trim().toLowerCase()));

      function preventChipFocus(targetContainer) {
        if (!targetContainer) return;

        targetContainer.addEventListener('mousedown', (event) => {
          if (event.target.closest('.multi-select__chip-remove')) return;
          event.preventDefault();
          event.stopPropagation();
        });

        targetContainer.addEventListener('click', (event) => {
          if (event.target.closest('.multi-select__chip-remove')) return;
          event.preventDefault();
          event.stopPropagation();
        });
      }

      function openDropdown() {
        dropdown.classList.add('multi-select__dropdown--open');
        control?.setAttribute('aria-expanded', 'true');
        container.classList.add('multi-select--open');
        renderOptions(input.value.trim());
      }

      input.addEventListener('focus', openDropdown);
      input.addEventListener('input', (event) => {
        renderOptions(event.target.value.trim());
      });
      input.addEventListener('blur', () => {
        const pendingValue = input.value.trim();
        setTimeout(() => {
          const nextFocus = document.activeElement;

          if (nextFocus && container.contains(nextFocus)) {
            return;
          }

          if (pendingValue && !normalizedOptions.has(pendingValue.toLowerCase())) {
            input.value = '';
            input.dispatchEvent(new Event('input', { bubbles: true }));
          }

          closeDropdown();
        }, 0);
      });

      control?.addEventListener('mousedown', (event) => {
        if (event.target.closest('.multi-select__chip')) return;
        event.preventDefault();
        input.focus();
      });

      chevron?.addEventListener('click', () => {
        if (dropdown.classList.contains('multi-select__dropdown--open')) {
          closeDropdown();
        } else {
          input.focus();
          openDropdown();
        }
      });

      document.addEventListener('click', (event) => {
        if (container.contains(event.target)) return;
        closeDropdown();
      });

      preventChipFocus(valuesContainer);
      preventChipFocus(selectionContainer);

      renderOptions();
      updateValidator();
      updateHiddenInputs();

      return {
        setValues(values = []) {
          selected.clear();
          values
            .filter(Boolean)
            .forEach((value) => {
              if (options.includes(value)) selected.add(value);
            });
          renderSelected();
          updateHiddenInputs();
          updateValidator();
          renderOptions('');
        },
        getValues() {
          return Array.from(selected);
        },
      };
    }

    function collectMultiSelectValues(container) {
      if (!container) return [];

      return Array.from(container.querySelectorAll('.multi-select__hidden input[name]'))
        .map((input) => input.value)
        .filter(Boolean);
    }

    function setRowList(row, target, values = [], minRows = 1) {
      const listContainer = row.querySelector(`[data-list="${target}"]`);
      const addButton = row.querySelector(`[data-target="${target}"]`);

      if (!listContainer || !addButton) return;

      const desiredLength = Math.max(values.length, minRows);
      while (listContainer.querySelectorAll('.multi-input__row').length < desiredLength) {
        addButton.click();
      }

      const inputs = listContainer.querySelectorAll('input');
      inputs.forEach((input, index) => {
        input.value = values[index] ?? '';
      });

      const removeButtons = listContainer.querySelectorAll('.multi-input__remove');
      const cutoff = values.length ? values.length : minRows;

      for (let i = removeButtons.length - 1; i >= cutoff; i -= 1) {
        const removeButton = removeButtons[i];
        if (removeButton && !removeButton.disabled) {
          removeButton.click();
        }
      }
    }

    function setupRowList({ row, target, placeholder = '', startEmpty = false, minRows = 1 }) {
      const listContainer = row.querySelector(`[data-list="${target}"]`);
      const addButton = row.querySelector(`.curator-hours__add-item[data-target="${target}"]`);

      if (!listContainer || !addButton) return;

      function updateRemoveState() {
        const rows = listContainer.querySelectorAll('.multi-input__row');
        rows.forEach((currentRow) => {
          const removeButton = currentRow.querySelector('.multi-input__remove');
          if (!removeButton) return;
          removeButton.disabled = rows.length <= minRows;
        });
      }

      function attachRemove(listRow) {
        const removeButton = listRow.querySelector('.multi-input__remove');
        if (!removeButton) return;
        removeButton.addEventListener('click', () => {
          if (listContainer.querySelectorAll('.multi-input__row').length <= minRows) return;
          listRow.remove();
          updateRemoveState();
        });
      }

      function ensureMinimumRows() {
        while (listContainer.querySelectorAll('.multi-input__row').length < minRows) {
          const newRow = createListRow(placeholder);
          attachRemove(newRow);
          listContainer.prepend(newRow);
        }
      }

      if (!startEmpty) {
        const firstRow = createListRow(placeholder);
        attachRemove(firstRow);
        listContainer.prepend(firstRow);
        updateRemoveState();
      }

      ensureMinimumRows();

      addButton.addEventListener('click', () => {
        const newRow = createListRow(placeholder);
        attachRemove(newRow);
        listContainer.prepend(newRow);
        updateRemoveState();
      });
    }

    function collectDynamicList(container) {
      if (!container) return [];
      return Array.from(container.querySelectorAll('input'))
        .map((input) => sanitizeText(input.value))
        .filter(Boolean);
    }

    function splitRange(rangeText = '') {
      const [start = '', end = ''] = rangeText.split(/\s*[–-]\s*/);
      return { start, end };
    }

    function setManualReportingPeriod({ label = '', dateStart = '', dateEnd = '', deadline = '' } = {}) {
      if (reportingPeriodLabelInput) reportingPeriodLabelInput.value = label;
      if (reportingPeriodStartInput) reportingPeriodStartInput.value = dateStart;
      if (reportingPeriodEndInput) reportingPeriodEndInput.value = dateEnd;
      if (reportingPeriodDeadlineInput) reportingPeriodDeadlineInput.value = deadline;
    }

    function getManualReportingPeriod() {
      const label = sanitizeText(reportingPeriodLabelInput?.value || '');
      const dateStart = reportingPeriodStartInput?.value || '';
      const dateEnd = reportingPeriodEndInput?.value || '';
      const deadline = reportingPeriodDeadlineInput?.value || '';

      return {
        label,
        date_start: dateStart,
        date_end: dateEnd,
        deadline,
        display: buildReportingPeriodDisplay({ label, dateStart, dateEnd, deadline }),
      };
    }

    function buildReportingPeriodDisplay({ label, dateStart, dateEnd, deadline }) {
      const range = formatDateRange(dateStart, dateEnd);
      const hasRange = range && range !== '—';

      if (label && hasRange) {
        return `${label}: ${range}${deadline ? ` (Прислать отчёт до ${deadline})` : ''}`;
      }

      if (hasRange) {
        return `${range}${deadline ? ` (Прислать отчёт до ${deadline})` : ''}`;
      }

      return deadline || '';
    }

    function collectReportingPeriod() {
      return getManualReportingPeriod();
    }

    function createCuratorHoursRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'curator-hours__row';
      const directionDropdownId = `curator-hours-directions-list-${++curatorHoursDirectionDropdownId}`;
      const directionLabelId = `curator-hours-direction-label-${curatorHoursDirectionDropdownId}`;
      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Группы</span>
              <button type="button" class="chip chip--interactive curator-hours__add-item" data-target="groups">Добавить</button>
            </div>
            <div class="multi-input" data-list="groups"></div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата или период</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="date-range__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="date-range__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Тема</span>
            <textarea class="curator-hours__topic" placeholder="Например, профилактическая беседа" rows="3"></textarea>
          </label>
          <div class="field field--compact" role="group" aria-labelledby="${directionLabelId}">
            <div class="field__label-row">
              <span class="field__label" id="${directionLabelId}">Направленность</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: выберите одну или несколько направленностей"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">
                  Выберите одну или несколько направленностей из списка. Чтобы удалить выбранное, нажмите на крестик на метке.
                </div>
              </div>
            </div>
            <div class="multi-select" data-name="curator_hour_directions">
              <div
                class="multi-select__control multi-select__control--input"
                role="combobox"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-owns="${directionDropdownId}"
              >
                <div class="multi-select__values multi-select__values--hidden" aria-live="polite"></div>
                <input
                  type="text"
                  class="multi-select__input"
                  placeholder="Начните вводить направленность"
                  aria-labelledby="${directionLabelId}"
                />
                <button type="button" class="multi-select__chevron" aria-hidden="true">▾</button>
              </div>
              <div class="multi-select__dropdown" id="${directionDropdownId}" role="listbox"></div>
              <div class="multi-select__hidden" aria-hidden="true"></div>
              <input
                type="text"
                class="multi-select__validator"
                name="curator_hour_directions_validator"
                aria-hidden="true"
                tabindex="-1"
                required
              />
              <div class="multi-select__selection" aria-live="polite"></div>
            </div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Приглашённые специалисты</span>
              <button type="button" class="chip chip--interactive curator-hours__add-item" data-target="specialists">Добавить</button>
            </div>
            <div class="multi-input" data-list="specialists"></div>
          </div>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove curator-hours__remove-row" aria-label="Удалить строку">×</button>
        </div>
      `;

      setupRowList({ row, target: 'groups', placeholder: 'Например, 1234', startEmpty: true, minRows: 0 });
      setupRowList({
        row,
        target: 'specialists',
        placeholder: 'Например, приглашённый специалист',
        startEmpty: true,
        minRows: 0,
      });

      const directionSelect = setupSearchableMultiSelect({
        name: 'curator_hour_directions',
        options: directionsOptions,
        placeholder: 'Начните вводить направленность',
        container: row.querySelector('[data-name="curator_hour_directions"]'),
        selectedContainer: row.querySelector('.multi-select__selection'),
      });

      if (directionSelect) {
        curatorHoursDirectionSelects.set(row, directionSelect);
      }

      const removeButton = row.querySelector('.curator-hours__remove-row');

      if (removeButton && !isRemovable) {
        removeButton.disabled = true;
        removeButton.setAttribute('aria-disabled', 'true');
        removeButton.dataset.fixed = 'true';
      }

      return row;
    }

    function updateRowRemovalState() {
      const rows = curatorHoursRows.querySelectorAll('.curator-hours__row');
      rows.forEach((row) => {
        const removeButton = row.querySelector('.curator-hours__remove-row');
        if (!removeButton) return;
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
          return;
        }
        removeButton.disabled = rows.length === 1;
      });
    }

    function addCuratorHourRow(options = {}) {
      const row = createCuratorHoursRow(options);
      const removeButton = row.querySelector('.curator-hours__remove-row');

      if (removeButton) {
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
        } else {
          removeButton.addEventListener('click', () => {
            if (curatorHoursRows.querySelectorAll('.curator-hours__row').length === 1) return;
            curatorHoursDirectionSelects.delete(row);
            row.remove();
            updateRowRemovalState();
          });
        }
      }

      curatorHoursRows.prepend(row);
      setupTooltips();
      updateRowRemovalState();

      return row;
    }

    function collectCuratorHoursRows() {
      return Array.from(curatorHoursRows.querySelectorAll('.curator-hours__row'))
        .map((row) => {
          const groups = collectDynamicList(row.querySelector('[data-list="groups"]'));
          const specialists = collectDynamicList(row.querySelector('[data-list="specialists"]'));
          const dateStart = row.querySelector('.date-range__start')?.value || '';
          const dateEnd = row.querySelector('.date-range__end')?.value || '';
          const topic = sanitizeText(row.querySelector('.curator-hours__topic')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="curator_hour_directions"]'));

          if (!groups.length && !specialists.length && !dateStart && !dateEnd && !topic && !directions.length) {
            return null;
          }

          return { groups, date_start: dateStart, date_end: dateEnd, topic, directions, specialists };
        })
        .filter(Boolean);
    }

    function fillCuratorHoursRows(rows = []) {
      curatorHoursRows.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addCuratorHourRow();

          if (!row) return;

          setRowList(row, 'groups', item.groups || [], 0);
          setRowList(row, 'specialists', item.specialists || [], 0);
          row.querySelector('.date-range__start').value = item.date_start || '';
          row.querySelector('.date-range__end').value = item.date_end || '';
          const topicField = row.querySelector('.curator-hours__topic');
          if (topicField) topicField.value = item.topic || '';
          const directionSelect = curatorHoursDirectionSelects.get(row);
          directionSelect?.setValues(item.directions || []);
        });

      updateRowRemovalState();
      setupTooltips();
    }

    function collectAchievements() {
      return Array.from(achievementRowsContainer.querySelectorAll('.achievement-row'))
        .map((row) => {
          const dateStart = row.querySelector('.achievement-date__start')?.value || '';
          const dateEnd = row.querySelector('.achievement-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('textarea[name="achievement_event"]')?.value || '');
          const group = sanitizeText(row.querySelector('input[name="achievement_group"]')?.value || '');
          const student = sanitizeText(row.querySelector('input[name="achievement_student"]')?.value || '');
          const result = sanitizeText(row.querySelector('textarea[name="achievement_result"]')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="achievement_directions"]'));

          if (!dateStart && !dateEnd && !event && !group && !student && !result && directions.length === 0) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, group, student, result, directions };
        })
        .filter(Boolean);
    }

    function fillAchievementRows(rows = []) {
      achievementRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addAchievementRow();
          row.querySelector('.achievement-date__start').value = item.date_start || '';
          row.querySelector('.achievement-date__end').value = item.date_end || '';
          row.querySelector('textarea[name="achievement_event"]').value = item.event || '';
          row.querySelector('input[name="achievement_group"]').value = item.group || '';
          row.querySelector('input[name="achievement_student"]').value = item.student || '';
          row.querySelector('textarea[name="achievement_result"]').value = item.result || '';
          const directionSelect = achievementDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      setupTooltips();
    }

    function collectMentorSupportRows() {
      if (!mentorSupportRowsContainer || mentorSupportRowsContainer.children.length === 0) return [];

      return Array.from(mentorSupportRowsContainer.querySelectorAll('.achievement-row'))
        .map((row) => {
          const dateStart = row.querySelector('.mentor-support-date__start')?.value || '';
          const dateEnd = row.querySelector('.mentor-support-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('textarea[name="mentor_support_event"]')?.value || '');
          const group = sanitizeText(row.querySelector('input[name="mentor_support_group"]')?.value || '');
          const student = sanitizeText(row.querySelector('input[name="mentor_support_student"]')?.value || '');
          const result = sanitizeText(row.querySelector('textarea[name="mentor_support_result"]')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="mentor_support_directions"]'));

          if (!dateStart && !dateEnd && !event && !group && !student && !result && directions.length === 0) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, group, student, result, directions };
        })
        .filter(Boolean);
    }

    function fillMentorSupportRows(rows = []) {
      if (!mentorSupportRowsContainer) return;

      mentorSupportRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addMentorSupportRow();
          row.querySelector('.mentor-support-date__start').value = item.date_start || '';
          row.querySelector('.mentor-support-date__end').value = item.date_end || '';
          row.querySelector('textarea[name="mentor_support_event"]').value = item.event || '';
          row.querySelector('input[name="mentor_support_group"]').value = item.group || '';
          row.querySelector('input[name="mentor_support_student"]').value = item.student || '';
          row.querySelector('textarea[name="mentor_support_result"]').value = item.result || '';
          const directionSelect = mentorSupportDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      setupTooltips();
    }

    function collectJointEvents() {
      if (!jointEventsDetails || jointEventRowsContainer.children.length === 0) return [];

      return Array.from(jointEventRowsContainer.querySelectorAll('.joint-events__row'))
        .map((row) => {
          const groups = collectDynamicList(row.querySelector('[data-list="groups"]'));
          const dateStart = row.querySelector('.joint-events-date__start')?.value || '';
          const dateEnd = row.querySelector('.joint-events-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('textarea[name="joint_event_description"]')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="joint_event_directions"]'));

          if (!groups.length && !dateStart && !dateEnd && !event && directions.length === 0) {
            return null;
          }

          return { groups, date_start: dateStart, date_end: dateEnd, event, directions };
        })
        .filter(Boolean);
    }

    function fillJointEventsRows(rows = []) {
      jointEventRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addJointEventRow();
          setRowList(row, 'groups', item.groups || [], 0);
          row.querySelector('.joint-events-date__start').value = item.date_start || '';
          row.querySelector('.joint-events-date__end').value = item.date_end || '';
          const description = row.querySelector('textarea[name="joint_event_description"]');
          if (description) description.value = item.event || '';
          const directionSelect = jointEventDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
          jointEventRowsContainer.prepend(row);
        });

      setupTooltips();
    }

    function collectExtracurricularRows() {
      if (!extracurricularDetails || extracurricularRowsContainer.children.length === 0) return [];

      return Array.from(extracurricularRowsContainer.querySelectorAll('.extracurricular-row'))
        .map((row) => {
          const dateStart = row.querySelector('.extracurricular-date__start')?.value || '';
          const dateEnd = row.querySelector('.extracurricular-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('.extracurricular-event__description')?.value || '');
          const directions = collectMultiSelectValues(
            row.querySelector('[data-name="curator_personal_event_directions"]')
          );

          if (!dateStart && !dateEnd && !event && directions.length === 0) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, directions };
        })
        .filter(Boolean);
    }

    function fillExtracurricularRows(rows = []) {
      extracurricularRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addExtracurricularRow();

          if (!row) return;

          row.querySelector('.extracurricular-date__start').value = item.date_start || '';
          row.querySelector('.extracurricular-date__end').value = item.date_end || '';
          const description = row.querySelector('.extracurricular-event__description');
          if (description) description.value = item.event || '';
          const directionSelect = curatorPersonalEventDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      updateExtracurricularRowRemovalState();
      setupTooltips();
    }

    function collectPersonalProgramRows() {
      if (!personalProgramRowsContainer || personalProgramRowsContainer.children.length === 0) return [];

      return Array.from(personalProgramRowsContainer.querySelectorAll('.personal-program-row'))
        .map((row) => {
          const dateStart = row.querySelector('.personal-program-date__start')?.value || '';
          const dateEnd = row.querySelector('.personal-program-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('.personal-program-event__description')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="personal_program_directions"]'));

          if (!dateStart && !dateEnd && !event && directions.length === 0) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, directions };
        })
        .filter(Boolean);
    }

    function fillPersonalProgramRows(rows = []) {
      if (!personalProgramRowsContainer) return;

      personalProgramRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addPersonalProgramRow();

          if (!row) return;

          row.querySelector('.personal-program-date__start').value = item.date_start || '';
          row.querySelector('.personal-program-date__end').value = item.date_end || '';
          const description = row.querySelector('.personal-program-event__description');
          if (description) description.value = item.event || '';
          const directionSelect = personalProgramDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      setupTooltips();
    }

    function collectScientificWorks() {
      if (!scientificWorkRowsContainer || scientificWorkRowsContainer.children.length === 0) return [];

      return Array.from(scientificWorkRowsContainer.querySelectorAll('.scientific-work-row'))
        .map((row) => {
          const description = sanitizeText(row.querySelector('.scientific-work__description')?.value || '');
          const link = sanitizeText(row.querySelector('.scientific-work__link')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="scientific_work_directions"]'));

          if (!description && !link && directions.length === 0) {
            return null;
          }

          return { description, link, directions };
        })
        .filter(Boolean);
    }

    function fillScientificWorks(rows = []) {
      if (!scientificWorkRowsContainer) return;

      scientificWorkRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addScientificWorkRow();

          if (!row) return;

          const description = row.querySelector('.scientific-work__description');
          const link = row.querySelector('.scientific-work__link');
          if (description) description.value = item.description || '';
          if (link) link.value = item.link || '';
          const directionSelect = scientificWorkDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });
    }

    function collectInterviews() {
      if (!interviewRowsContainer || interviewRowsContainer.children.length === 0) return [];

      return Array.from(interviewRowsContainer.querySelectorAll('.interview-row'))
        .map((row) => {
          const link = sanitizeText(row.querySelector('.interview__link')?.value || '');
          const directions = collectMultiSelectValues(row.querySelector('[data-name="media_material_directions"]'));

          if (!link && directions.length === 0) {
            return null;
          }

          return { link, directions };
        })
        .filter(Boolean);
    }

    function fillInterviews(rows = []) {
      if (!interviewRowsContainer) return;

      interviewRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addInterviewRow();

          if (!row) return;

          const link = row.querySelector('.interview__link');
          if (link) link.value = item.link || '';
          const directionSelect = interviewDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      setupTooltips();
    }

    function collectQualificationCourses() {
      if (!qualificationCourseRowsContainer || qualificationCourseRowsContainer.children.length === 0) return [];

      return Array.from(qualificationCourseRowsContainer.querySelectorAll('.qualification-course-row'))
        .map((row) => {
          const dateStart = row.querySelector('.qualification-course-date__start')?.value || '';
          const dateEnd = row.querySelector('.qualification-course-date__end')?.value || '';
          const event = sanitizeText(row.querySelector('.qualification-course__description')?.value || '');
          const directions = collectMultiSelectValues(
            row.querySelector('[data-name="qualification_course_directions"]')
          );

          if (!dateStart && !dateEnd && !event && directions.length === 0) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, directions };
        })
        .filter(Boolean);
    }

    function fillQualificationCourses(rows = []) {
      if (!qualificationCourseRowsContainer) return;

      qualificationCourseRowsContainer.innerHTML = '';

      rows
        .slice()
        .reverse()
        .forEach((item) => {
          const row = addQualificationCourseRow();

          if (!row) return;

          row.querySelector('.qualification-course-date__start').value = item.date_start || '';
          row.querySelector('.qualification-course-date__end').value = item.date_end || '';
          const description = row.querySelector('.qualification-course__description');
          if (description) description.value = item.event || '';
          const directionSelect = qualificationCourseDirectionSelects.get(row);
          const directions = Array.isArray(item.directions) ? item.directions : [];
          directionSelect?.setValues(directions);
        });

      setupTooltips();
    }

    function toggleCuratorHoursDetails() {
      const isHeld = getBooleanRadio('held_minimum_three_curator_sessions_in_reporting_period');
      curatorHoursDetails.hidden = !isHeld;

      if (isHeld && !curatorHoursRows.children.length) {
        Array.from({ length: 3 }).forEach(() => addCuratorHourRow({ isRemovable: false }));
      }
    }

    function toggleJointActivitiesDetails() {
      const isInforming = getBooleanRadio('inform_group_about_events');
      jointActivitiesDetails.hidden = !isInforming;

      if (!isInforming) {
        achievementRowsContainer.innerHTML = '';
        jointEventsDetails.hidden = true;
        jointEventRowsContainer.innerHTML = '';
        form
          .querySelectorAll(
            'input[name="manages_group_chat"], input[name="participated_in_two_events_with_group"]'
          )
          .forEach((input) => {
            input.checked = false;
          });
      }
    }

    function toggleJointParticipationDetails() {
      const isParticipating = getBooleanRadio('participated_in_two_events_with_group');
      jointEventsDetails.hidden = !isParticipating;

      if (!isParticipating) {
        jointEventRowsContainer.innerHTML = '';
        return;
      }

      if (!jointEventRowsContainer.children.length) {
        Array.from({ length: 2 }).forEach(() => {
          jointEventRowsContainer.prepend(addJointEventRow({ isRemovable: false }));
        });
      }
    }

    function toggleExtracurricularDetails() {
      const isParticipating = getBooleanRadio('participated_in_two_curator_events');
      extracurricularDetails.hidden = !isParticipating;

      if (!isParticipating) {
        extracurricularRowsContainer.innerHTML = '';
        return;
      }

      if (!extracurricularRowsContainer.children.length) {
        Array.from({ length: 2 }).forEach(() => {
          addExtracurricularRow({ isRemovable: false });
        });
      }
    }

    function ensureCuratorDirectionsFilled() {
      const isHeld = getBooleanRadio('held_minimum_three_curator_sessions_in_reporting_period');
      if (!isHeld) return true;

      const rows = Array.from(curatorHoursRows.querySelectorAll('.curator-hours__row'));
      const rowsWithoutDirections = rows.filter((row) => {
        const directions = collectMultiSelectValues(row.querySelector('[data-name="curator_hour_directions"]'));
        return directions.length === 0;
      });

      if (!rowsWithoutDirections.length) return true;

      alert('Добавьте хотя бы одну направленность в каждую строку вопроса 12 перед скачиванием отчёта.');
      document.getElementById('question-12')?.scrollIntoView({ behavior: 'smooth', block: 'start' });

      return false;
    }

    function buildReportData() {
      const heldMinimumThreeCuratorSessions = getBooleanRadio('held_minimum_three_curator_sessions_in_reporting_period');
      const participatedInCuratorEvents = getBooleanRadio('participated_in_two_curator_events');
      return {
        _comments: fieldComments,
        reporting_period: collectReportingPeriod(),
        full_name: getValue('full_name'),
        job_positions: collectList('job_positions'),
        department: getValue('department'),
        contact_phone_connected_to_telegram: getValue('contact_phone_connected_to_telegram'),
        telegram_username: getValue('telegram_username'),
        email: getValue('email'),
        curated_group_numbers: collectList('curated_group_numbers'),
        curator_primary_building: getValue('curator_primary_building'),
        curator_primary_room: getValue('curator_primary_room'),
        institute_or_faculty: collectFaculties(),
        held_minimum_three_curator_sessions_in_reporting_period: heldMinimumThreeCuratorSessions,
        curator_hours_details: heldMinimumThreeCuratorSessions ? collectCuratorHoursRows() : [],
        manages_group_chat: getBooleanRadio('manages_group_chat'),
        inform_group_about_events: getBooleanRadio('inform_group_about_events'),
        achievements: getBooleanRadio('inform_group_about_events') ? collectAchievements() : [],
        participated_in_two_events_with_group: getBooleanRadio('participated_in_two_events_with_group'),
        joint_participation_events: getBooleanRadio('participated_in_two_events_with_group')
          ? collectJointEvents()
          : [],
        participated_in_two_curator_events: participatedInCuratorEvents,
        curator_personal_events: participatedInCuratorEvents ? collectExtracurricularRows() : [],
        personal_program_participation: collectPersonalProgramRows(),
        mentor_support_events: collectMentorSupportRows(),
        scientific_publications: collectScientificWorks(),
        media_materials: collectInterviews(),
        qualification_courses: collectQualificationCourses(),
      };
    }

    function buildReport() {
      return JSON.stringify(buildReportData(), null, 2);
    }

    function generateFileName(extension = 'json') {
      const [lastName = '', firstName = '', patronymic = ''] = getValue('full_name')
        .split(/\s+/)
        .filter(Boolean);
      const parts = ['Отчёт_о_кураторской_деятельности'];

      if (firstName) parts.push(firstName);
      if (lastName) parts.push(lastName);
      if (patronymic) parts.push(patronymic);

      return `${parts.join('_')}.${extension}`;
    }

    function formatBoolean(value) {
      if (value === true) return 'Да';
      if (value === false) return 'Нет';
      return '—';
    }

    function formatList(items, fallback = '—') {
      if (!Array.isArray(items) || !items.length) return fallback;
      return items.join(', ');
    }

    function formatDateRange(start, end) {
      if (start && end) return `${start} — ${end}`;
      return start || end || '—';
    }

    function formatReportingPeriod(period) {
      if (!period) return '';

      const display = period.display || '';
      if (display) return display;

      const range = formatDateRange(period.date_start, period.date_end);
      const hasRange = range && range !== '—';

      if (period.label && hasRange) {
        return `${period.label}: ${range}${period.deadline ? ` (Прислать отчёт до ${period.deadline})` : ''}`;
      }

      if (hasRange) {
        return `${range}${period.deadline ? ` (Прислать отчёт до ${period.deadline})` : ''}`;
      }

      return period.deadline || '';
    }

    function buildPdfContent(data) {
      const lines = [];

      const addLine = (question, answer) => {
        const safeAnswer = answer ?? '—';
        lines.push({ text: `${question}: ${safeAnswer || '—'}` });
      };

      const addList = (question, items, formatter) => {
        if (!Array.isArray(items) || items.length === 0) {
          addLine(question, '—');
          return;
        }

        lines.push({ text: question });
        lines.push({ ul: items.map(formatter), margin: [8, 4, 0, 8] });
      };

      addLine('Отчетный период', formatReportingPeriod(data.reporting_period) || '—');
      addLine('1. Фамилия Имя Отчество *', data.full_name);
      addList('2. Должность *', data.job_positions, (position, index) => `${index + 1}. ${position || '—'}`);
      addLine('3. Кафедра *', data.department);
      addLine('4. Контактный телефон (подключенный к Telegram) *', data.contact_phone_connected_to_telegram);
      addLine('5. Ник в Telegram *', data.telegram_username);
      addLine('6. E-mail *', data.email);
      addList(
        '7. Номера курируемых групп *',
        data.curated_group_numbers,
        (group, index) => `${index + 1}. ${group || '—'}`
      );
      addLine('8. Корпус основного пребывания куратора *', data.curator_primary_building);
      addLine('9. Аудитория основного пребывания куратора *', data.curator_primary_room);
      addList(
        '10. Институт/Факультет *',
        data.institute_or_faculty,
        (faculty, index) => `${index + 1}. ${faculty || '—'}`
      );
      addLine(
        '11. Проведение не менее трех кураторских часов за отчетный период *',
        formatBoolean(data.held_minimum_three_curator_sessions_in_reporting_period)
      );
      addList(
        '12. Даты проведения трех и более кураторских часов в течение отчетного периода',
        data.curator_hours_details,
        (hour, index) =>
          `${index + 1}. Группы: ${formatList(hour.groups)}, Специалисты: ${formatList(
            hour.specialists
          )}, Период: ${formatDateRange(hour.date_start, hour.date_end)}, Направления: ${formatList(
            hour.directions
          )}, Тема: ${hour.topic || '—'}`
      );
      addLine(
        '13. Ведение чата с каждой группой или общего чата со всеми группами *',
        formatBoolean(data.manages_group_chat)
      );
      addLine(
        '14. Информирование группы о мероприятиях и событиях различного уровня *',
        formatBoolean(data.inform_group_about_events)
      );
      addList(
        '15. Призовое место обучающегося во внеучебных мероприятиях, конкурсах, получение грантов',
        data.achievements,
        (achievement, index) =>
          `${index + 1}. Период: ${formatDateRange(achievement.date_start, achievement.date_end)}, ` +
          `Событие: ${achievement.event || '—'}, группа: ${achievement.group || '—'}, студент(ы): ${
            achievement.student || '—'
          }, результат: ${achievement.result || '—'}, направленность: ${formatList(achievement.directions)}`
      );
      addLine(
        '16. Совместное участие с группой не менее чем в двух мероприятиях в течение отчетного периода *',
        formatBoolean(data.participated_in_two_events_with_group)
      );
      addList(
        '17. Даты проведения двух и более мероприятий в течение отчетного периода',
        data.joint_participation_events,
        (event, index) =>
          `${index + 1}. Группы: ${formatList(event.groups)}, Период: ${formatDateRange(
            event.date_start,
            event.date_end
          )}, Мероприятие: ${event.event || '—'}, Направленность: ${formatList(event.directions)}`
      );
      addLine(
        '18. Участие не менее чем в двух мероприятиях  для кураторов: собрания, совещания,  тренинги, мастер-классы, конкурс кураторов *',
        formatBoolean(data.participated_in_two_curator_events)
      );
      addList(
        '19. Даты участия не менее чем в двух мероприятиях  для кураторов: собрания, совещания, тренинги, мастер-классы, конкурс кураторов',
        data.curator_personal_events,
        (event, index) =>
          `${index + 1}. Период: ${formatDateRange(event.date_start, event.date_end)}, Мероприятие: ${
            event.event || '—'
          }, Направленность: ${
            formatList(event.directions)
          }`
      );
      addList(
        '20. Личное участие в региональных, межмуниципальных, федеральных программах, конкурсах, мероприятиях по работе с детьми и молодежью, воспитательной работе, молодежной политике (форумы, «Голос поколения», конкурс кураторов РГПУ им. Герцена и т.д.)',
        data.personal_program_participation,
        (event, index) =>
          `${index + 1}. Период: ${formatDateRange(event.date_start, event.date_end)}, Мероприятие: ${
            event.event || '—'
          }, Направленность: ${formatList(event.directions)}`
      );
      addList(
        '21. Участие куратора в роли наставника проекта, а также в подготовке к чемпионату, конкурсу, конференции и др.',
        data.mentor_support_events,
        (event, index) =>
          `${index + 1}. Период: ${formatDateRange(event.date_start, event.date_end)}, Мероприятие: ${
            event.event || '—'
          }, Направленность: ${formatList(event.directions)}, группа: ${event.group || '—'}, студент(ы): ${
            event.student || '—'
          }, результат: ${event.result || '—'}`
      );
      addList(
        '22. Опубликование научной работы (в том числе монографии, научной статьи, доклада, тезисов доклада и т.д. на темы, связанные с молодежной политикой и воспитательной деятельностью, с указанием принадлежности автора к ГУАП (в том числе в форме электронного издания))',
        data.scientific_publications,
        (publication, index) =>
          `${index + 1}. ${publication.description || '—'}${publication.link ? ` — ${publication.link}` : ''}`
      );
      addList(
        '23. Интервью и статьи для «Дзен.ГУАП», соцсетей и сайта ГУАП',
        data.media_materials,
        (material, index) =>
          `${index + 1}. Направленность: ${formatList(material.directions)}, Ссылка: ${material.link || '—'}`
      );
      addList(
        '24. Курсы повышения квалификации в области молодежной политики и воспитательной деятельности',
        data.qualification_courses,
        (course, index) =>
          `${index + 1}. Период: ${formatDateRange(course.date_start, course.date_end)}, Курс: ${
            course.event || '—'
          }, Направленность: ${formatList(course.directions)}`
      );

      return lines;
    }

    function buildPdfDefinition(data) {
      const content = [
        { text: 'Отчёт по кураторской деятельности', style: 'header' },
        { text: formatReportingPeriod(data.reporting_period), style: 'subheader' },
        { text: 'Сводка ответов', style: 'sectionTitle', margin: [0, 12, 0, 6] },
        { stack: buildPdfContent(data), style: 'list' },
      ];

      return {
        info: {
          title: 'Отчёт по кураторской деятельности',
        },
        content,
        defaultStyle: {
          fontSize: 11,
        },
        styles: {
          header: {
            fontSize: 18,
            bold: true,
            margin: [0, 0, 0, 6],
          },
          subheader: {
            fontSize: 12,
            margin: [0, 0, 0, 12],
          },
          sectionTitle: {
            fontSize: 12,
            bold: true,
          },
          list: {
            lineHeight: 1.4,
          },
        },
      };
    }

    function populateFromJson(data) {
      if (!data || typeof data !== 'object') {
        alert('Не удалось загрузить файл: неверный формат данных.');
        return;
      }

      form.reset();

      curatorHoursRows.innerHTML = '';
      achievementRowsContainer.innerHTML = '';
      jointEventRowsContainer.innerHTML = '';
      extracurricularRowsContainer.innerHTML = '';
      personalProgramRowsContainer.innerHTML = '';
      if (mentorSupportRowsContainer) mentorSupportRowsContainer.innerHTML = '';
      if (scientificWorkRowsContainer) scientificWorkRowsContainer.innerHTML = '';
      if (interviewRowsContainer) interviewRowsContainer.innerHTML = '';
      if (qualificationCourseRowsContainer) qualificationCourseRowsContainer.innerHTML = '';

      selectReportingPeriod(data.reporting_period);
      form.elements.full_name.value = data.full_name || '';

      const importedJobPositions = Array.isArray(data.job_positions) ? data.job_positions : [];
      const validJobPositions = importedJobPositions.filter((value) =>
        jobPositionOptionsNormalized.has((value || '').trim().toLowerCase())
      );
      jobPositionsSelect?.setValues(validJobPositions);

      const departmentValue = (data.department || '').trim();
      form.elements.department.value = departmentOptionsNormalized.has(departmentValue.toLowerCase())
        ? departmentValue
        : '';
      form.elements.contact_phone_connected_to_telegram.value =
        data.contact_phone_connected_to_telegram || '';
      form.elements.telegram_username.value = data.telegram_username || '';
      form.elements.email.value = data.email || '';
      fillMultiInput(
        'curated_group_numbers',
        Array.isArray(data.curated_group_numbers) ? data.curated_group_numbers : [],
        0
      );
      const buildingValue = (data.curator_primary_building || '').trim();
      form.elements.curator_primary_building.value = primaryBuildingOptionsNormalized.has(
        buildingValue.toLowerCase()
      )
        ? buildingValue
        : '';

      const roomValue = (data.curator_primary_room || '').trim();
      form.elements.curator_primary_room.value = primaryRoomOptionsNormalized.has(roomValue.toLowerCase())
        ? roomValue
        : '';

      const faculties = Array.isArray(data.institute_or_faculty) ? data.institute_or_faculty : [];
      form.querySelectorAll('input[name="institute_or_faculty"]').forEach((input) => {
        input.checked = faculties.includes(input.value);
      });

      setRadioValue(
        'held_minimum_three_curator_sessions_in_reporting_period',
        data.held_minimum_three_curator_sessions_in_reporting_period
      );
      curatorHoursRows.innerHTML = '';
      if (data.held_minimum_three_curator_sessions_in_reporting_period) {
        fillCuratorHoursRows(Array.isArray(data.curator_hours_details) ? data.curator_hours_details : []);
      }

      setRadioValue('manages_group_chat', data.manages_group_chat);

      setRadioValue('inform_group_about_events', data.inform_group_about_events);
      achievementRowsContainer.innerHTML = '';
      if (data.inform_group_about_events) {
        fillAchievementRows(Array.isArray(data.achievements) ? data.achievements : []);
      }

      setRadioValue('participated_in_two_events_with_group', data.participated_in_two_events_with_group);
      jointEventRowsContainer.innerHTML = '';
      if (data.participated_in_two_events_with_group) {
        fillJointEventsRows(
          Array.isArray(data.joint_participation_events) ? data.joint_participation_events : []
        );
      }

      setRadioValue('participated_in_two_curator_events', data.participated_in_two_curator_events);
      extracurricularRowsContainer.innerHTML = '';
      if (data.participated_in_two_curator_events) {
        fillExtracurricularRows(
          Array.isArray(data.curator_personal_events) ? data.curator_personal_events : []
        );
      }

      fillPersonalProgramRows(
        Array.isArray(data.personal_program_participation) ? data.personal_program_participation : []
      );
      fillMentorSupportRows(Array.isArray(data.mentor_support_events) ? data.mentor_support_events : []);
      fillScientificWorks(Array.isArray(data.scientific_publications) ? data.scientific_publications : []);
      fillInterviews(Array.isArray(data.media_materials) ? data.media_materials : []);
      fillQualificationCourses(
        Array.isArray(data.qualification_courses) ? data.qualification_courses : []
      );

      toggleCuratorHoursDetails();
      toggleJointActivitiesDetails();
      toggleJointParticipationDetails();
      toggleExtracurricularDetails();
    }

    enhanceDatalistInput(form.elements.department);
    enhanceDatalistInput(form.elements.curator_primary_room);
    document.querySelectorAll('.select-shell select').forEach(enhanceSelectDropdown);
    addSelectBlurValidation(form.elements.curator_primary_building);

    setupTooltips();

    jobPositionsSelect = setupSearchableMultiSelect({
      name: 'job_positions',
      options: jobPositionOptions,
      placeholder: 'Начните вводить должность',
    });

    setupMultiInput({
      name: 'curated_group_numbers',
      inputName: 'curated_group_number',
      placeholder: 'Например, 1234 или 4102',
      minRows: 0,
    });

    addCuratorHourRowButton.addEventListener('click', () => addCuratorHourRow());

    if (addAchievementRowButton) {
      addAchievementRowButton.addEventListener('click', () => {
        addAchievementRow();
      });
    }

    if (addJointEventRowButton) {
      addJointEventRowButton.addEventListener('click', () => {
        jointEventRowsContainer.prepend(addJointEventRow());
      });
    }

    if (addExtracurricularRowButton) {
      addExtracurricularRowButton.addEventListener('click', () => addExtracurricularRow());
    }

    if (addPersonalProgramRowButton) {
      addPersonalProgramRowButton.addEventListener('click', () => addPersonalProgramRow());
    }

    if (addMentorSupportRowButton) {
      addMentorSupportRowButton.addEventListener('click', () => {
        addMentorSupportRow();
      });
    }

    if (addScientificWorkRowButton) {
      addScientificWorkRowButton.addEventListener('click', () => {
        addScientificWorkRow();
      });
    }

    if (addInterviewRowButton) {
      addInterviewRowButton.addEventListener('click', () => {
        addInterviewRow();
      });
    }

    if (addQualificationCourseRowButton) {
      addQualificationCourseRowButton.addEventListener('click', () => {
        addQualificationCourseRow();
      });
    }

    form
      .querySelectorAll('input[name="held_minimum_three_curator_sessions_in_reporting_period"]')
      .forEach((radio) => radio.addEventListener('change', toggleCuratorHoursDetails));

    form
      .querySelectorAll('input[name="inform_group_about_events"]')
      .forEach((radio) => radio.addEventListener('change', toggleJointActivitiesDetails));

    form
      .querySelectorAll('input[name="participated_in_two_events_with_group"]')
      .forEach((radio) => radio.addEventListener('change', toggleJointParticipationDetails));

    form
      .querySelectorAll('input[name="participated_in_two_curator_events"]')
      .forEach((radio) => radio.addEventListener('change', toggleExtracurricularDetails));

    toggleCuratorHoursDetails();
    toggleJointActivitiesDetails();
    toggleJointParticipationDetails();
    toggleExtracurricularDetails();

    if (importButton && importInput) {
      importButton.addEventListener('click', () => importInput.click());
      importInput.addEventListener('change', () => {
        const [file] = importInput.files || [];
        if (!file) return;

        file
          .text()
          .then((content) => {
            let data;
            try {
              data = JSON.parse(content);
            } catch (error) {
              alert('Не удалось прочитать файл: неверный JSON.');
              return;
            }

            populateFromJson(data);
          })
          .catch(() => {
            alert('Не удалось прочитать файл. Попробуйте еще раз.');
          })
          .finally(() => {
            importInput.value = '';
          });
      });
    }

    if (exportJsonButton) {
      exportJsonButton.addEventListener('click', () => {
        if (!ensureCuratorDirectionsFilled()) return;
        const reportData = buildReportData();
        const report = JSON.stringify(reportData, null, 2);
        const blob = new Blob([report], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = generateFileName('json');
        document.body.appendChild(link);
        link.click();
        link.remove();
        URL.revokeObjectURL(url);
      });
    }

    if (exportPdfButton) {
      exportPdfButton.addEventListener('click', () => {
        if (!ensureCuratorDirectionsFilled()) return;
        const reportData = buildReportData();
        const pdfDefinition = buildPdfDefinition(reportData);
        pdfMake.createPdf(pdfDefinition).download(generateFileName('pdf'));
      });
    }
  </script>
</body>
</html>
