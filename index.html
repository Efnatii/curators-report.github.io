<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Отчет по кураторской деятельности</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="hero">
    <div class="container hero__content">
      <div class="hero__badge">Анкета</div>
      <h1>Отчет по кураторской деятельности</h1>
      <p class="lede">Анкета для фиксации данных кураторской деятельности.</p>
    </div>
  </header>

  <main>
    <div class="container">
      <form id="curator-form" class="form">
        <section class="form-section" aria-labelledby="section-general">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 1 из 10</p>
              <h2 id="section-general">Общие сведения о кураторе</h2>
              <p class="muted">Вводная информация для идентификации куратора и его группы.</p>
            </div>
          </div>
          <div class="field-grid">
            <label class="field">
              <span class="field__label">1. Фамилия Имя Отчество *</span>
              <input type="text" name="full_name" placeholder="Например, Иванов Иван Иванович" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">2. Должность *</span>
                <div class="field__meta">
                  <div class="tooltip">
                    <button
                      type="button"
                      class="tooltip__trigger"
                      aria-label="Подсказка: добавляйте по одной должности в каждую строку"
                      aria-expanded="false"
                    >
                      ?
                    </button>
                    <div class="tooltip__bubble" role="tooltip">Добавляйте по одной должности в каждую строку.</div>
                  </div>
                  <button type="button" class="chip chip--interactive" data-add="job_positions">Добавить</button>
                </div>
              </div>
              <div class="multi-input" data-name="job_positions">
                <div class="multi-input__row">
                  <input type="text" name="job_position" placeholder="Например, старший преподаватель" required />
                  <button type="button" class="multi-input__remove" aria-label="Удалить запись">&times;</button>
                </div>
              </div>
            </div>
            <label class="field">
              <span class="field__label">3. Кафедра *</span>
              <input type="text" name="department" placeholder="Например, кафедра компьютерных систем" required />
            </label>
            <label class="field">
              <span class="field__label">4. Контактный телефон (подключенный к Telegram) *</span>
              <input type="tel" name="contact_phone_connected_to_telegram" placeholder="Например, +7 999 000-00-00" required />
            </label>
            <label class="field">
              <span class="field__label">5. Ник в Telegram *</span>
              <input type="text" name="telegram_username" placeholder="Например, @curator_help" required />
            </label>
            <label class="field">
              <span class="field__label">6. E-mail *</span>
              <input type="email" name="email" placeholder="Например, curator@example.ru" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">7. Номера курируемых групп *</span>
                <div class="field__meta">
                  <div class="tooltip">
                    <button
                      type="button"
                      class="tooltip__trigger"
                      aria-label="Подсказка: добавьте по одному номеру группы в каждую строку"
                      aria-expanded="false"
                    >
                      ?
                    </button>
                    <div class="tooltip__bubble" role="tooltip">Добавьте по одному номеру группы в каждую строку.</div>
                  </div>
                  <button type="button" class="chip chip--interactive" data-add="curated_group_numbers">Добавить</button>
                </div>
              </div>
              <div class="multi-input" data-name="curated_group_numbers">
                <div class="multi-input__row">
                  <input type="text" name="curated_group_number" placeholder="Например, 1234 или 4102" required />
                  <button type="button" class="multi-input__remove" aria-label="Удалить запись">&times;</button>
                </div>
              </div>
            </div>
            <label class="field">
              <span class="field__label">8. Корпус основного пребывания куратора *</span>
              <input type="text" name="curator_primary_building" placeholder="Например, корпус 1" required />
            </label>
            <label class="field">
              <span class="field__label">9. Аудитория основного пребывания куратора *</span>
              <input type="text" name="curator_primary_room" placeholder="Например, аудитория 301" required />
            </label>
          </div>
          <fieldset class="choice-card">
            <legend class="legend-with-tooltip">
              <span>10. Институт/Факультет *</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: можно выбрать один или несколько вариантов"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Выберите один или несколько вариантов.</div>
              </div>
            </legend>
            <div class="choices">
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт аэрокосмических приборов и систем" />
                <span>Институт аэрокосмических приборов и систем</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт радиотехники и инфокоммуникационных технологий" />
                <span>Институт радиотехники и инфокоммуникационных технологий</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт киберфизических систем" />
                <span>Институт киберфизических систем</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт информационных технологий и программирования" />
                <span>Институт информационных технологий и программирования</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт фундаментальной подготовки и технологических инноваций" />
                <span>Институт фундаментальной подготовки и технологических инноваций</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Гуманитарный факультет" />
                <span>Гуманитарный факультет</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Институт технологий предпринимательства и права" />
                <span>Институт технологий предпринимательства и права</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="institute_or_faculty" value="Военный учебный центр при ГУАП (ВУЦ)" />
                <span>Военный учебный центр при ГУАП (ВУЦ)</span>
              </label>
            </div>
        </fieldset>
      </section>

        <section class="form-section" aria-labelledby="section-curator-hours">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 2 из 10</p>
              <h2 id="section-curator-hours">Информация о проведении кураторских часов</h2>
              <p class="muted">Данные о количестве, тематиках и направлениях проведённых кураторских часов</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">11. Проведение не менее трех кураторских часов за отчетный период *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="held_minimum_three_curator_sessions_in_reporting_period" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="held_minimum_three_curator_sessions_in_reporting_period" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="curator-hours-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                <p class="section-counter">Дополнительный вопрос</p>
                <h3>12. Даты проведения трех и более кураторских часов в течение отчетного периода</h3>
                <p class="muted">Заполните данные по каждому проведенному кураторскому часу.</p>
              </div>
              <div class="tooltip tooltip--standalone">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: укажите минимум три записи с деталями каждого кураторского часа"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Укажите минимум три записи с деталями каждого кураторского часа.</div>
              </div>
              <button type="button" class="chip chip--interactive" id="add-curator-hour-row">Добавить строку</button>
            </div>

            <div class="curator-hours" id="curator-hours-rows"></div>
          </div>
        </section>

        <section class="form-section" aria-labelledby="section-collaboration">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 3 из 10</p>
              <h2 id="section-collaboration">Совместные мероприятия с курируемой группой</h2>
              <p class="muted">Отражает совместную активность куратора и студентов.</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">13. Ведение чата с каждой группой или общего чата со всеми группами *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="manages_group_chat" value="true" />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="manages_group_chat" value="false" />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <fieldset class="choice-card">
            <legend class="field__label">14. Информирование группы о мероприятиях и событиях различного уровня *</legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="inform_group_about_events" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="inform_group_about_events" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="joint-activities-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                  <h3 class="additional-title">Дополнительные вопросы</h3>
              </div>
            </div>

            <div class="form-subsection form-subsection--borderless">
              <div class="section-header section-header--sub">
                <div>
                  <h3>15. Призовое место обучающегося во внеучебных мероприятиях, конкурсах, получение грантов</h3>
                  <p class="muted">Добавьте записи только при наличии результатов. Таблица по умолчанию пустая.</p>
                </div>
                <button type="button" class="chip chip--interactive" id="add-achievement-row">Добавить строку</button>
              </div>
              <div class="achievement-table" id="achievement-rows"></div>
            </div>

            <fieldset class="choice-card">
            <legend class="field__label">16. Совместное участие с группой не менее чем в двух мероприятиях в течение отчетного периода *</legend>
              <div class="choices">
                <label class="choice">
                  <input type="radio" name="participated_in_two_events_with_group" value="true" />
                  <span>Да</span>
                </label>
                <label class="choice">
                  <input type="radio" name="participated_in_two_events_with_group" value="false" />
                  <span>Нет</span>
                </label>
              </div>
            </fieldset>

            <div id="joint-events-details" class="form-subsection" hidden>
              <div class="section-header section-header--sub">
                <div>
                  <p class="section-counter">Дополнительный вопрос</p>
                  <h3>17. Даты проведения двух и более мероприятий в течение отчетного периода</h3>
                  <p class="muted">Заполните данные по каждому совместному мероприятию.</p>
                </div>
                <div class="tooltip tooltip--standalone">
                  <button
                    type="button"
                    class="tooltip__trigger"
                    aria-label="Подсказка: укажите минимум две записи с деталями каждого мероприятия"
                    aria-expanded="false"
                  >
                    ?
                  </button>
                  <div class="tooltip__bubble" role="tooltip">Укажите минимум две записи с деталями каждого мероприятия.</div>
                </div>
                <button type="button" class="chip chip--interactive" id="add-joint-event-row">Добавить строку</button>
              </div>
              <div class="joint-events" id="joint-event-rows"></div>
            </div>
          </div>
        </section>

        <section class="form-section" aria-labelledby="section-curator-extracurricular">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 4 из 10</p>
              <h2 id="section-curator-extracurricular">Внеучебная деятельность куратора</h2>
              <p class="muted">Личное участие и наставничество куратора в программах, форумах и конкурсах.</p>
            </div>
          </div>

          <fieldset class="choice-card">
            <legend class="field__label">
              18. Участие не менее чем в двух мероприятиях  для кураторов: собрания, совещания,  тренинги, мастер-классы, конкурс
              кураторов *
            </legend>
            <div class="choices">
              <label class="choice">
                <input type="radio" name="participated_in_two_curator_events" value="true" required />
                <span>Да</span>
              </label>
              <label class="choice">
                <input type="radio" name="participated_in_two_curator_events" value="false" required />
                <span>Нет</span>
              </label>
            </div>
          </fieldset>

          <div id="curator-extracurricular-details" class="form-subsection" hidden>
            <div class="section-header section-header--sub">
              <div>
                <p class="section-counter">Дополнительный вопрос</p>
                <h3>
                  19. Даты участия не менее чем в двух мероприятиях  для кураторов: собрания, совещания, тренинги, мастер-классы,
                  конкурс кураторов
                </h3>
                <p class="muted">Заполните данные по каждому мероприятию.</p>
              </div>
              <div class="tooltip tooltip--standalone">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: укажите минимум две записи с деталями каждого мероприятия"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Укажите минимум две записи с деталями каждого мероприятия.</div>
              </div>
              <button type="button" class="chip chip--interactive" id="add-extracurricular-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="extracurricular-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>
                  20. Личное участие в региональных, межмуниципальных, федеральных программах, конкурсах, мероприятиях по работе с
                  детьми и молодежью, воспитательной работе, молодежной политике (форумы, «Голос поколения», конкурс кураторов РГПУ
                  им. Герцена и т.д.)
                </h3>
                <p class="muted">Добавьте записи по необходимости. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-personal-program-row">Добавить строку</button>
            </div>
            <div class="curator-hours" id="personal-program-rows"></div>
          </div>

          <div class="form-subsection form-subsection--borderless">
            <div class="section-header section-header--sub">
              <div>
                <h3>
                  21. Участие куратора в роли наставника проекта, а также в подготовке к чемпионату, конкурсу, конференции и др.
                </h3>
                <p class="muted">Добавьте записи только при наличии наставничества. Таблица по умолчанию пустая.</p>
              </div>
              <button type="button" class="chip chip--interactive" id="add-mentor-support-row">Добавить строку</button>
            </div>
            <div class="achievement-table" id="mentor-support-rows"></div>
          </div>
        </section>

        <div class="actions">
          <button type="button" id="download" class="button">Скачать ответы</button>
          <p class="muted">Кнопка сформирует JSON-файл с вашими ответами.</p>
        </div>
      </form>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__content">
      <div class="footer__links">
        <a href="#section-general">К началу формы</a>
      </div>
      <p class="footnote">
        © Copyrights —
        <a href="https://github.com/Efnatii" rel="noopener noreferrer">Efnatii</a>
        (Гороховицкий Е. Р.).
        <a href="LICENSE" rel="license noopener noreferrer">MIT License</a>
      </p>
    </div>
  </footer>

  <script>
    const form = document.getElementById('curator-form');
    const downloadButton = document.getElementById('download');
    const curatorHoursDetails = document.getElementById('curator-hours-details');
    const curatorHoursRows = document.getElementById('curator-hours-rows');
    const addCuratorHourRowButton = document.getElementById('add-curator-hour-row');
    const jointActivitiesDetails = document.getElementById('joint-activities-details');
    const addAchievementRowButton = document.getElementById('add-achievement-row');
    const achievementRowsContainer = document.getElementById('achievement-rows');
    const jointEventsDetails = document.getElementById('joint-events-details');
    const jointEventRowsContainer = document.getElementById('joint-event-rows');
    const addJointEventRowButton = document.getElementById('add-joint-event-row');
    const extracurricularDetails = document.getElementById('curator-extracurricular-details');
    const extracurricularRowsContainer = document.getElementById('extracurricular-rows');
    const addExtracurricularRowButton = document.getElementById('add-extracurricular-row');
    const personalProgramRowsContainer = document.getElementById('personal-program-rows');
    const addPersonalProgramRowButton = document.getElementById('add-personal-program-row');
    const mentorSupportRowsContainer = document.getElementById('mentor-support-rows');
    const addMentorSupportRowButton = document.getElementById('add-mentor-support-row');

    const directionsOptions = [
      'Гражданская',
      'Патриотическая',
      'Духовно-нравственная',
      'Волонтерская (добровольческая)',
      'Культурно-творческая',
      'Научно-образовательная',
      'Спортивно-оздоровительная',
      'Экологическая',
      'Информационная (коммуникационная)',
      'Туристическая',
      'Предпринимательская',
      'Корпоративная идентичность',
      'Профессионально-трудовая',
    ];

    const fieldComments = {
      _meta: 'Комментарии добавлены для ориентира и не влияют на валидацию данных.',
      full_name: 'Фамилия Имя Отчество куратора.',
      job_positions: 'Список должностей куратора; каждая строка — отдельная должность.',
      department: 'Кафедра или структурное подразделение, в котором работает куратор.',
      contact_phone_connected_to_telegram: 'Контактный телефон, привязанный к аккаунту Telegram.',
      telegram_username: 'Никнейм в Telegram, начиная с @.',
      email: 'Рабочий адрес электронной почты.',
      curated_group_numbers: 'Номера групп, с которыми куратор работает в отчётном периоде.',
      curator_primary_building: 'Корпус основного пребывания куратора.',
      curator_primary_room: 'Аудитория (кабинет), в которой куратор чаще всего находится.',
      institute_or_faculty: 'Институты или факультеты, закреплённые за куратором.',
      held_minimum_three_curator_sessions_in_reporting_period:
        'Отметьте, проведены ли минимум три кураторских часа в отчётный период.',
      curator_hours_details: {
        _comment: 'Детализация проведённых кураторских часов.',
        groups: 'Группы, участвовавшие в занятии (список).',
        specialists: 'Приглашённые специалисты (список).',
        date_start: 'Дата начала или единственная дата занятия.',
        date_end: 'Дата окончания, если занятие длилось несколько дней.',
        topic: 'Тема кураторского часа.',
        directions: 'Направления воспитательной работы, раскрытые на занятии.',
      },
      inform_group_about_events: 'Куратор информирует обучающихся о мероприятиях для участия.',
      achievements: {
        _comment: 'Достижения обучающихся и групп.',
        date_start: 'Дата начала или единственная дата достижения.',
        date_end: 'Дата окончания, если достижение относится к периоду.',
        event: 'Название или описание мероприятия/конкурса.',
        group: 'Номер группы, к которой относится достижение.',
        student: 'ФИО студента или студентов.',
        result: 'Полученный результат: место, статус, грант и т.д.',
      },
      manages_group_chat: 'Куратор администрирует чат или ведёт переписку с группой.',
      participated_in_two_events_with_group: 'Куратор посетил минимум два мероприятия вместе с группой.',
      joint_participation_events: {
        _comment: 'Совместные мероприятия с участием куратора и группы.',
        groups: 'Группы-участники мероприятия (список).',
        date_start: 'Дата начала или основная дата мероприятия.',
        date_end: 'Дата окончания, если мероприятие длилось несколько дней.',
        event: 'Краткое описание или название мероприятия.',
      },
      participated_in_two_curator_events: 'Куратор принял участие минимум в двух мероприятиях для кураторов.',
      curator_personal_events: {
        _comment: 'Сведения о личном участии куратора в программах, форумах и конкурсах.',
        date_start: 'Дата начала или единственная дата участия.',
        date_end: 'Дата окончания периода участия, если применимо.',
        event: 'Название или описание мероприятия.',
      },
      personal_program_participation: {
        _comment:
          'Участие куратора в программах, конкурсах и мероприятиях по работе с молодежью на региональном и федеральном уровнях.',
        date_start: 'Дата начала или единственная дата участия.',
        date_end: 'Дата окончания участия, если мероприятие длилось несколько дней.',
        event: 'Название или описание программы, конкурса или мероприятия.',
      },
      mentor_support_events: {
        _comment:
          'Наставничество куратора в проектах и подготовке к чемпионатам, конкурсам, конференциям и другим мероприятиям.',
        date_start: 'Дата начала или единственная дата наставничества.',
        date_end: 'Дата окончания, если наставничество длилось несколько дней.',
        event: 'Название мероприятия или проекта.',
        group: 'Группа, с которой работал куратор.',
        student: 'ФИО студента или команды.',
        result: 'Результат участия: итог, статус, достижение.',
      },
    };

    function closeAllTooltips(except = null) {
      document.querySelectorAll('.tooltip.tooltip--active').forEach((tooltip) => {
        if (tooltip === except) return;
        const trigger = tooltip.querySelector('.tooltip__trigger');
        tooltip.classList.remove('tooltip--active');
        if (trigger) {
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
    }

    function createAchievementRow() {
      const row = document.createElement('div');
      row.className = 'achievement-row';

      row.innerHTML = `
        <div class="achievement-grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата либо период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="achievement-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="achievement-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea name="achievement_event" placeholder="Например, участие в городском конкурсе проектов"></textarea>
          </label>
          <label class="field field--compact">
            <span class="field__label">Группа</span>
            <input type="text" name="achievement_group" placeholder="Например, 4102" />
          </label>
          <label class="field field--compact">
            <span class="field__label">ФИО студента</span>
            <input type="text" name="achievement_student" placeholder="Например, Петрова Анна Сергеевна" />
          </label>
          <label class="field field--compact">
            <span class="field__label">Итог</span>
            <textarea name="achievement_result" placeholder="Например, 2 место, грант на разработку проекта"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove achievement-row__remove" aria-label="Удалить запись">&times;</button>
      `;

      const removeButton = row.querySelector('.achievement-row__remove');
      removeButton.addEventListener('click', () => row.remove());

      return row;
    }

    function createMentorSupportRow() {
      const row = document.createElement('div');
      row.className = 'achievement-row';

      row.innerHTML = `
        <div class="achievement-grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата либо период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="mentor-support-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="mentor-support-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea name="mentor_support_event" placeholder="Например, подготовка к конференции или чемпионату"></textarea>
          </label>
          <label class="field field--compact">
            <span class="field__label">Группа</span>
            <input type="text" name="mentor_support_group" placeholder="Например, 4102" />
          </label>
          <label class="field field--compact">
            <span class="field__label">ФИО студента</span>
            <input type="text" name="mentor_support_student" placeholder="Например, Иванова Елена Петровна" />
          </label>
          <label class="field field--compact">
            <span class="field__label">Итог</span>
            <textarea name="mentor_support_result" placeholder="Например, вышли в финал конкурса"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove achievement-row__remove" aria-label="Удалить запись">&times;</button>
      `;

      const removeButton = row.querySelector('.achievement-row__remove');
      removeButton.addEventListener('click', () => row.remove());

      return row;
    }

    function createJointEventRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'joint-events__row';

      row.innerHTML = `
        <div class="joint-events__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Группы</span>
              <button
                type="button"
                class="chip chip--interactive curator-hours__add-item joint-events__add-item"
                data-target="groups"
              >
                Добавить
              </button>
            </div>
            <div class="multi-input" data-list="groups"></div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="joint-events-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="joint-events-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятия</span>
            <textarea name="joint_event_description" placeholder="Например, участие в двух выставках"></textarea>
          </label>
        </div>
        <button type="button" class="multi-input__remove joint-events__row-remove" aria-label="Удалить запись">&times;</button>
      `;

      const listContainer = row.querySelector('[data-list="groups"]');
      const addButton = row.querySelector('.joint-events__add-item[data-target="groups"]');

      if (listContainer && addButton) {
        setupRowList({ row, target: 'groups', placeholder: 'Например, 4102', startEmpty: false });
      }

      const removeButton = row.querySelector('.joint-events__row-remove');

      if (removeButton) {
        if (!isRemovable) {
          removeButton.disabled = true;
          removeButton.setAttribute('aria-disabled', 'true');
        } else {
          removeButton.addEventListener('click', () => row.remove());
        }
      }

      return row;
    }

    function createExtracurricularRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'curator-hours__row extracurricular-row';

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="extracurricular-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="extracurricular-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea class="extracurricular-event__description" placeholder="Например, участие в форуме наставников" rows="3"></textarea>
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove extracurricular-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.extracurricular-row__remove');

      if (removeButton) {
        if (!isRemovable) {
          removeButton.disabled = true;
          removeButton.setAttribute('aria-disabled', 'true');
          removeButton.dataset.fixed = 'true';
        } else {
          removeButton.addEventListener('click', () => row.remove());
        }
      }

      return row;
    }

    function updateExtracurricularRowRemovalState() {
      const rows = extracurricularRowsContainer.querySelectorAll('.extracurricular-row');
      rows.forEach((row) => {
        const removeButton = row.querySelector('.extracurricular-row__remove');
        if (!removeButton) return;
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
          return;
        }
        removeButton.disabled = rows.length === 1;
      });
    }

    function addExtracurricularRow(options = {}) {
      const row = createExtracurricularRow(options);
      const removeButton = row.querySelector('.extracurricular-row__remove');

      if (removeButton && !removeButton.dataset.fixed) {
        removeButton.addEventListener('click', () => {
          if (extracurricularRowsContainer.querySelectorAll('.extracurricular-row').length === 1) return;
          row.remove();
          updateExtracurricularRowRemovalState();
        });
      }

      extracurricularRowsContainer.append(row);
      setupTooltips();
      updateExtracurricularRowRemovalState();
    }

    function createPersonalProgramRow() {
      const row = document.createElement('div');
      row.className = 'curator-hours__row personal-program-row';

      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата (дата или период)</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="personal-program-date__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="personal-program-date__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Мероприятие</span>
            <textarea class="personal-program-event__description" placeholder="Например, участие в форуме «Голос поколения»" rows="3"></textarea>
          </label>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove personal-program-row__remove" aria-label="Удалить строку">×</button>
        </div>
      `;

      const removeButton = row.querySelector('.personal-program-row__remove');
      if (removeButton) {
        removeButton.addEventListener('click', () => row.remove());
      }

      return row;
    }

    function addPersonalProgramRow() {
      const row = createPersonalProgramRow();
      personalProgramRowsContainer.append(row);
      setupTooltips();
    }

    function setupTooltips() {
      const triggers = document.querySelectorAll('.tooltip__trigger');

      triggers.forEach((trigger) => {
        if (trigger.dataset.tooltipReady) return;

        const tooltip = trigger.closest('.tooltip');
        if (!tooltip) return;

        trigger.dataset.tooltipReady = 'true';

        trigger.addEventListener('click', (event) => {
          event.stopPropagation();
          const isActive = tooltip.classList.toggle('tooltip--active');
          trigger.setAttribute('aria-expanded', String(isActive));

          if (isActive) {
            closeAllTooltips(tooltip);
          }
        });

        trigger.addEventListener('blur', () => {
          setTimeout(() => {
            if (!tooltip.contains(document.activeElement)) {
              tooltip.classList.remove('tooltip--active');
              trigger.setAttribute('aria-expanded', 'false');
            }
          }, 120);
        });
      });

      document.addEventListener('click', (event) => {
        if (event.target.closest('.tooltip')) return;
        closeAllTooltips();
      });
    }

    function createRow(inputName, placeholder = '') {
      const row = document.createElement('div');
      row.className = 'multi-input__row';

      const input = document.createElement('input');
      input.type = 'text';
      input.name = inputName;
      input.required = true;
      input.placeholder = placeholder;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'multi-input__remove';
      removeButton.setAttribute('aria-label', 'Удалить запись');
      removeButton.textContent = '×';

      row.append(input, removeButton);
      return row;
    }

    function setupMultiInput({ name, inputName, placeholder = '' }) {
      const container = form.querySelector(`[data-name="${name}"]`);
      const addButton = form.querySelector(`[data-add="${name}"]`);

      if (!container || !addButton) return;

      function updateRemoveState() {
        const rows = container.querySelectorAll('.multi-input__row');
        rows.forEach((row) => {
          const removeButton = row.querySelector('.multi-input__remove');
          if (!removeButton) return;
          const isDisabled = rows.length === 1;
          removeButton.disabled = isDisabled;
        });
      }

      function attachRemove(row) {
        const removeButton = row.querySelector('.multi-input__remove');
        if (!removeButton) return;
        removeButton.addEventListener('click', () => {
          if (container.querySelectorAll('.multi-input__row').length === 1) return;
          row.remove();
          updateRemoveState();
        });
      }

      container.querySelectorAll('.multi-input__row').forEach((row) => attachRemove(row));

      addButton.addEventListener('click', () => {
        const newRow = createRow(inputName, placeholder);
        attachRemove(newRow);
        container.append(newRow);
        updateRemoveState();
      });

      updateRemoveState();
    }

    function collectFaculties() {
      return Array.from(form.querySelectorAll('input[name="institute_or_faculty"]:checked')).map((input) => input.value);
    }

    function getBooleanRadio(name) {
      const selected = form.querySelector(`input[name="${name}"]:checked`);
      if (!selected) return null;
      return selected.value === 'true';
    }

    function getSelectedRadio(name) {
      const selected = form.querySelector(`input[name="${name}"]:checked`);
      return selected ? selected.value : '';
    }

    function getValue(name) {
      return form.elements[name]?.value.trim() || '';
    }

    function collectList(name) {
      const container = form.querySelector(`[data-name="${name}"]`);
      if (!container) return [];
      return Array.from(container.querySelectorAll('input'))
        .map((input) => input.value.trim())
        .filter(Boolean);
    }

    function createListRow(placeholder = '') {
      const row = document.createElement('div');
      row.className = 'multi-input__row';

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = placeholder;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'multi-input__remove';
      removeButton.setAttribute('aria-label', 'Удалить запись');
      removeButton.textContent = '×';

      row.append(input, removeButton);
      return row;
    }

    function setupRowList({ row, target, placeholder = '', startEmpty = false }) {
      const listContainer = row.querySelector(`[data-list="${target}"]`);
      const addButton = row.querySelector(`.curator-hours__add-item[data-target="${target}"]`);

      if (!listContainer || !addButton) return;

      function updateRemoveState() {
        const rows = listContainer.querySelectorAll('.multi-input__row');
        rows.forEach((currentRow) => {
          const removeButton = currentRow.querySelector('.multi-input__remove');
          if (!removeButton) return;
          removeButton.disabled = rows.length === 1;
        });
      }

      function attachRemove(listRow) {
        const removeButton = listRow.querySelector('.multi-input__remove');
        if (!removeButton) return;
        removeButton.addEventListener('click', () => {
          if (listContainer.querySelectorAll('.multi-input__row').length === 1) return;
          listRow.remove();
          updateRemoveState();
        });
      }

      if (!startEmpty) {
        const firstRow = createListRow(placeholder);
        attachRemove(firstRow);
        listContainer.append(firstRow);
        updateRemoveState();
      }

      addButton.addEventListener('click', () => {
        const newRow = createListRow(placeholder);
        attachRemove(newRow);
        listContainer.append(newRow);
        updateRemoveState();
      });
    }

    function createDirectionChip(value, container) {
      if (!value || container.querySelector(`[data-direction-value="${value}"]`)) return;
      const chip = document.createElement('span');
      chip.className = 'pill pill--compact';
      chip.dataset.directionValue = value;
      chip.textContent = value;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'pill__remove';
      removeButton.setAttribute('aria-label', 'Удалить направление');
      removeButton.textContent = '×';
      removeButton.addEventListener('click', () => chip.remove());

      chip.append(removeButton);
      container.append(chip);
    }

    function setupDirections(row) {
      const select = row.querySelector('.curator-hours__direction-input');
      const addButton = row.querySelector('.curator-hours__add-direction');
      const listContainer = row.querySelector('[data-list="directions"]');

      if (!select || !addButton || !listContainer) return;

      directionsOptions.forEach((option) => {
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option;
        select.append(opt);
      });

      addButton.addEventListener('click', () => {
        createDirectionChip(select.value, listContainer);
      });
    }

    function collectDirections(container) {
      if (!container) return [];
      return Array.from(container.querySelectorAll('[data-direction-value]')).map((chip) => chip.dataset.directionValue);
    }

    function collectDynamicList(container) {
      if (!container) return [];
      return Array.from(container.querySelectorAll('input'))
        .map((input) => input.value.trim())
        .filter(Boolean);
    }

    function createCuratorHoursRow({ isRemovable = true } = {}) {
      const row = document.createElement('div');
      row.className = 'curator-hours__row';
      row.innerHTML = `
        <div class="curator-hours__grid">
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Группы</span>
              <button type="button" class="chip chip--interactive curator-hours__add-item" data-target="groups">Добавить</button>
            </div>
            <div class="multi-input" data-list="groups"></div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Дата или период</span>
              <div class="tooltip">
                <button
                  type="button"
                  class="tooltip__trigger"
                  aria-label="Подсказка: оставьте конечную дату пустой, если указана одна дата"
                  aria-expanded="false"
                >
                  ?
                </button>
                <div class="tooltip__bubble" role="tooltip">Оставьте конечную дату пустой, если указана одна дата.</div>
              </div>
            </div>
            <div class="date-range">
              <input type="date" class="date-range__start" aria-label="Дата начала" />
              <span class="date-range__dash">—</span>
              <input type="date" class="date-range__end" aria-label="Дата окончания" />
            </div>
          </div>
          <label class="field field--compact">
            <span class="field__label">Тема</span>
            <textarea class="curator-hours__topic" placeholder="Например, профилактическая беседа" rows="3"></textarea>
          </label>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Направленность</span>
              <div class="field__meta">
                <div class="tooltip">
                  <button
                    type="button"
                    class="tooltip__trigger"
                    aria-label="Подсказка: выберите направление и нажмите плюс, чтобы добавить его"
                    aria-expanded="false"
                  >
                    ?
                  </button>
                  <div class="tooltip__bubble" role="tooltip">Выберите направление в списке ниже и нажмите «+», чтобы добавить его. Можно указать несколько направлений; для удаления используйте крестик на метке.</div>
                </div>
                <button type="button" class="chip chip--interactive curator-hours__add-direction">+</button>
              </div>
            </div>
            <div class="curator-hours__direction-select">
              <select class="curator-hours__direction-input"></select>
            </div>
            <div class="pill-list" data-list="directions"></div>
          </div>
          <div class="field field--compact">
            <div class="field__label-row">
              <span class="field__label">Приглашённые специалисты</span>
              <button type="button" class="chip chip--interactive curator-hours__add-item" data-target="specialists">Добавить</button>
            </div>
            <div class="multi-input" data-list="specialists"></div>
          </div>
        </div>
        <div class="curator-hours__row-actions">
          <button type="button" class="multi-input__remove curator-hours__remove-row" aria-label="Удалить строку">×</button>
        </div>
      `;

      setupRowList({ row, target: 'groups', placeholder: 'Например, 1234' });
      setupRowList({
        row,
        target: 'specialists',
        placeholder: 'Например, приглашённый специалист',
        startEmpty: true,
      });
      setupDirections(row);

      const removeButton = row.querySelector('.curator-hours__remove-row');

      if (removeButton && !isRemovable) {
        removeButton.disabled = true;
        removeButton.setAttribute('aria-disabled', 'true');
        removeButton.dataset.fixed = 'true';
      }

      return row;
    }

    function updateRowRemovalState() {
      const rows = curatorHoursRows.querySelectorAll('.curator-hours__row');
      rows.forEach((row) => {
        const removeButton = row.querySelector('.curator-hours__remove-row');
        if (!removeButton) return;
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
          return;
        }
        removeButton.disabled = rows.length === 1;
      });
    }

    function addCuratorHourRow(options = {}) {
      const row = createCuratorHoursRow(options);
      const removeButton = row.querySelector('.curator-hours__remove-row');

      if (removeButton) {
        if (removeButton.dataset.fixed === 'true') {
          removeButton.disabled = true;
        } else {
          removeButton.addEventListener('click', () => {
            if (curatorHoursRows.querySelectorAll('.curator-hours__row').length === 1) return;
            row.remove();
            updateRowRemovalState();
          });
        }
      }

      curatorHoursRows.append(row);
      setupTooltips();
      updateRowRemovalState();
    }

    function collectCuratorHoursRows() {
      return Array.from(curatorHoursRows.querySelectorAll('.curator-hours__row'))
        .map((row) => {
          const groups = collectDynamicList(row.querySelector('[data-list="groups"]'));
          const specialists = collectDynamicList(row.querySelector('[data-list="specialists"]'));
          const dateStart = row.querySelector('.date-range__start')?.value || '';
          const dateEnd = row.querySelector('.date-range__end')?.value || '';
          const topic = row.querySelector('.curator-hours__topic')?.value.trim() || '';
          const directions = collectDirections(row.querySelector('[data-list="directions"]'));

          if (!groups.length && !specialists.length && !dateStart && !dateEnd && !topic && !directions.length) {
            return null;
          }

          return { groups, date_start: dateStart, date_end: dateEnd, topic, directions, specialists };
        })
        .filter(Boolean);
    }

    function collectAchievements() {
      return Array.from(achievementRowsContainer.querySelectorAll('.achievement-row'))
        .map((row) => {
          const dateStart = row.querySelector('.achievement-date__start')?.value || '';
          const dateEnd = row.querySelector('.achievement-date__end')?.value || '';
          const event = row.querySelector('textarea[name="achievement_event"]')?.value.trim() || '';
          const group = row.querySelector('input[name="achievement_group"]')?.value.trim() || '';
          const student = row.querySelector('input[name="achievement_student"]')?.value.trim() || '';
          const result = row.querySelector('textarea[name="achievement_result"]')?.value.trim() || '';

          if (!dateStart && !dateEnd && !event && !group && !student && !result) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, group, student, result };
        })
        .filter(Boolean);
    }

    function collectMentorSupportRows() {
      if (!mentorSupportRowsContainer || mentorSupportRowsContainer.children.length === 0) return [];

      return Array.from(mentorSupportRowsContainer.querySelectorAll('.achievement-row'))
        .map((row) => {
          const dateStart = row.querySelector('.mentor-support-date__start')?.value || '';
          const dateEnd = row.querySelector('.mentor-support-date__end')?.value || '';
          const event = row.querySelector('textarea[name="mentor_support_event"]')?.value.trim() || '';
          const group = row.querySelector('input[name="mentor_support_group"]')?.value.trim() || '';
          const student = row.querySelector('input[name="mentor_support_student"]')?.value.trim() || '';
          const result = row.querySelector('textarea[name="mentor_support_result"]')?.value.trim() || '';

          if (!dateStart && !dateEnd && !event && !group && !student && !result) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event, group, student, result };
        })
        .filter(Boolean);
    }

    function collectJointEvents() {
      if (!jointEventsDetails || jointEventRowsContainer.children.length === 0) return [];

      return Array.from(jointEventRowsContainer.querySelectorAll('.joint-events__row'))
        .map((row) => {
          const groups = collectDynamicList(row.querySelector('[data-list="groups"]'));
          const dateStart = row.querySelector('.joint-events-date__start')?.value || '';
          const dateEnd = row.querySelector('.joint-events-date__end')?.value || '';
          const event = row.querySelector('textarea[name="joint_event_description"]')?.value.trim() || '';

          if (!groups.length && !dateStart && !dateEnd && !event) {
            return null;
          }

          return { groups, date_start: dateStart, date_end: dateEnd, event };
        })
        .filter(Boolean);
    }

    function collectExtracurricularRows() {
      if (!extracurricularDetails || extracurricularRowsContainer.children.length === 0) return [];

      return Array.from(extracurricularRowsContainer.querySelectorAll('.extracurricular-row'))
        .map((row) => {
          const dateStart = row.querySelector('.extracurricular-date__start')?.value || '';
          const dateEnd = row.querySelector('.extracurricular-date__end')?.value || '';
          const event = row.querySelector('.extracurricular-event__description')?.value.trim() || '';

          if (!dateStart && !dateEnd && !event) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event };
        })
        .filter(Boolean);
    }

    function collectPersonalProgramRows() {
      if (!personalProgramRowsContainer || personalProgramRowsContainer.children.length === 0) return [];

      return Array.from(personalProgramRowsContainer.querySelectorAll('.personal-program-row'))
        .map((row) => {
          const dateStart = row.querySelector('.personal-program-date__start')?.value || '';
          const dateEnd = row.querySelector('.personal-program-date__end')?.value || '';
          const event = row.querySelector('.personal-program-event__description')?.value.trim() || '';

          if (!dateStart && !dateEnd && !event) {
            return null;
          }

          return { date_start: dateStart, date_end: dateEnd, event };
        })
        .filter(Boolean);
    }

    function toggleCuratorHoursDetails() {
      const isHeld = getBooleanRadio('held_minimum_three_curator_sessions_in_reporting_period');
      curatorHoursDetails.hidden = !isHeld;

      if (isHeld && !curatorHoursRows.children.length) {
        Array.from({ length: 3 }).forEach(() => addCuratorHourRow({ isRemovable: false }));
      }
    }

    function toggleJointActivitiesDetails() {
      const isInforming = getBooleanRadio('inform_group_about_events');
      jointActivitiesDetails.hidden = !isInforming;

      if (!isInforming) {
        achievementRowsContainer.innerHTML = '';
        jointEventsDetails.hidden = true;
        jointEventRowsContainer.innerHTML = '';
        form
          .querySelectorAll(
            'input[name="manages_group_chat"], input[name="participated_in_two_events_with_group"]'
          )
          .forEach((input) => {
            input.checked = false;
          });
      }
    }

    function toggleJointParticipationDetails() {
      const isParticipating = getBooleanRadio('participated_in_two_events_with_group');
      jointEventsDetails.hidden = !isParticipating;

      if (!isParticipating) {
        jointEventRowsContainer.innerHTML = '';
        return;
      }

      if (!jointEventRowsContainer.children.length) {
        Array.from({ length: 2 }).forEach(() => {
          jointEventRowsContainer.append(createJointEventRow({ isRemovable: false }));
        });
      }
    }

    function toggleExtracurricularDetails() {
      const isParticipating = getBooleanRadio('participated_in_two_curator_events');
      extracurricularDetails.hidden = !isParticipating;

      if (!isParticipating) {
        extracurricularRowsContainer.innerHTML = '';
        return;
      }

      if (!extracurricularRowsContainer.children.length) {
        Array.from({ length: 2 }).forEach(() => {
          addExtracurricularRow({ isRemovable: false });
        });
      }
    }

    function buildReport() {
      const heldMinimumThreeCuratorSessions = getBooleanRadio('held_minimum_three_curator_sessions_in_reporting_period');
      const participatedInCuratorEvents = getBooleanRadio('participated_in_two_curator_events');
      const payload = {
        _comments: fieldComments,
        full_name: getValue('full_name'),
        job_positions: collectList('job_positions'),
        department: getValue('department'),
        contact_phone_connected_to_telegram: getValue('contact_phone_connected_to_telegram'),
        telegram_username: getValue('telegram_username'),
        email: getValue('email'),
        curated_group_numbers: collectList('curated_group_numbers'),
        curator_primary_building: getValue('curator_primary_building'),
        curator_primary_room: getValue('curator_primary_room'),
        institute_or_faculty: collectFaculties(),
        held_minimum_three_curator_sessions_in_reporting_period: heldMinimumThreeCuratorSessions,
        curator_hours_details: heldMinimumThreeCuratorSessions ? collectCuratorHoursRows() : [],
        manages_group_chat: getBooleanRadio('manages_group_chat'),
        inform_group_about_events: getBooleanRadio('inform_group_about_events'),
        achievements: getBooleanRadio('inform_group_about_events') ? collectAchievements() : [],
        participated_in_two_events_with_group: getBooleanRadio('participated_in_two_events_with_group'),
        joint_participation_events: getBooleanRadio('participated_in_two_events_with_group')
          ? collectJointEvents()
          : [],
        participated_in_two_curator_events: participatedInCuratorEvents,
        curator_personal_events: participatedInCuratorEvents ? collectExtracurricularRows() : [],
        personal_program_participation: collectPersonalProgramRows(),
        mentor_support_events: collectMentorSupportRows(),
      };
      return JSON.stringify(payload, null, 2);
    }

    function generateFileName() {
      const [lastName = '', firstName = '', patronymic = ''] = getValue('full_name')
        .split(/\s+/)
        .filter(Boolean);
      const parts = ['Отчёт_о_кураторской_деятельности'];

      if (firstName) parts.push(firstName);
      if (lastName) parts.push(lastName);
      if (patronymic) parts.push(patronymic);

      return `${parts.join('_')}.json`;
    }

    setupTooltips();

    setupMultiInput({
      name: 'job_positions',
      inputName: 'job_position',
      placeholder: 'Например, преподаватель-практик или тьютор',
    });

    setupMultiInput({
      name: 'curated_group_numbers',
      inputName: 'curated_group_number',
      placeholder: 'Например, 1234 или 4102',
    });

    addCuratorHourRowButton.addEventListener('click', () => addCuratorHourRow());

    if (addAchievementRowButton) {
      addAchievementRowButton.addEventListener('click', () => {
        achievementRowsContainer.append(createAchievementRow());
      });
    }

    if (addJointEventRowButton) {
      addJointEventRowButton.addEventListener('click', () => {
        jointEventRowsContainer.append(createJointEventRow());
      });
    }

    if (addExtracurricularRowButton) {
      addExtracurricularRowButton.addEventListener('click', () => addExtracurricularRow());
    }

    if (addPersonalProgramRowButton) {
      addPersonalProgramRowButton.addEventListener('click', () => addPersonalProgramRow());
    }

    if (addMentorSupportRowButton) {
      addMentorSupportRowButton.addEventListener('click', () => {
        mentorSupportRowsContainer.append(createMentorSupportRow());
        setupTooltips();
      });
    }

    form
      .querySelectorAll('input[name="held_minimum_three_curator_sessions_in_reporting_period"]')
      .forEach((radio) => radio.addEventListener('change', toggleCuratorHoursDetails));

    form
      .querySelectorAll('input[name="inform_group_about_events"]')
      .forEach((radio) => radio.addEventListener('change', toggleJointActivitiesDetails));

    form
      .querySelectorAll('input[name="participated_in_two_events_with_group"]')
      .forEach((radio) => radio.addEventListener('change', toggleJointParticipationDetails));

    form
      .querySelectorAll('input[name="participated_in_two_curator_events"]')
      .forEach((radio) => radio.addEventListener('change', toggleExtracurricularDetails));

    toggleCuratorHoursDetails();
    toggleJointActivitiesDetails();
    toggleJointParticipationDetails();
    toggleExtracurricularDetails();

    downloadButton.addEventListener('click', () => {
      const report = buildReport();
      const blob = new Blob([report], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = generateFileName();
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
