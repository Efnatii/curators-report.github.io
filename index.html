<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Отчет по кураторской деятельности</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="hero">
    <div class="container hero__content">
      <div class="hero__badge">Анкета</div>
      <h1>Отчет по кураторской деятельности</h1>
      <p class="lede">Анкета для фиксации данных кураторской деятельности.</p>
    </div>
  </header>

  <main>
    <div class="container">
      <form id="curator-form" class="form">
        <section class="form-section" aria-labelledby="section-general">
          <div class="section-header">
            <div>
              <p class="section-counter">Раздел 1 из 1</p>
              <h2 id="section-general">Общие сведения о кураторе</h2>
              <p class="muted">Вводная информация для идентификации куратора и его группы.</p>
            </div>
            <span class="chip">Обязательный</span>
          </div>
          <div class="field-grid">
            <label class="field">
              <span class="field__label">Фамилия Имя Отчество *</span>
              <input type="text" name="fullName" placeholder="Например, Иванов Иван Иванович" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">Должность *</span>
                <button type="button" class="chip chip--interactive" data-add="positions">Добавить</button>
              </div>
              <div class="multi-input" data-name="positions">
                <div class="multi-input__row">
                  <input type="text" name="position" placeholder="Например, старший преподаватель" required />
                  <button type="button" class="multi-input__remove" aria-label="Удалить запись">&times;</button>
                </div>
              </div>
              <p class="helper">Добавляйте по одной должности в каждую строку.</p>
            </div>
            <label class="field">
              <span class="field__label">Кафедра *</span>
              <input type="text" name="department" placeholder="Например, кафедра компьютерных систем" required />
            </label>
            <label class="field">
              <span class="field__label">Контактный телефон (подключенный к Telegram) *</span>
              <input type="tel" name="phone" placeholder="Например, +7 999 000-00-00" required />
            </label>
            <label class="field">
              <span class="field__label">Ник в Telegram *</span>
              <input type="text" name="telegramHandle" placeholder="Например, @curator_help" required />
            </label>
            <label class="field">
              <span class="field__label">E-mail *</span>
              <input type="email" name="email" placeholder="Например, curator@example.ru" required />
            </label>
            <div class="field field--wide">
              <div class="field__label-row">
                <span class="field__label">Номера курируемых групп *</span>
                <button type="button" class="chip chip--interactive" data-add="groupNumbers">Добавить</button>
              </div>
              <div class="multi-input" data-name="groupNumbers">
                <div class="multi-input__row">
                  <input type="text" name="groupNumber" placeholder="Например, 1234 или 4102" required />
                  <button type="button" class="multi-input__remove" aria-label="Удалить запись">&times;</button>
                </div>
              </div>
              <p class="helper">Добавьте по одному номеру группы в каждую строку.</p>
            </div>
            <label class="field">
              <span class="field__label">Корпус основного пребывания куратора *</span>
              <input type="text" name="baseBuilding" placeholder="Например, корпус 1" required />
              <p class="helper">Укажите корпус, где куратора можно найти чаще всего.</p>
            </label>
            <label class="field">
              <span class="field__label">Аудитория основного пребывания куратора *</span>
              <input type="text" name="baseRoom" placeholder="Например, аудитория 301" required />
              <p class="helper">Записывайте аудиторию, где чаще всего проводятся встречи.</p>
            </label>
          </div>
          <fieldset class="choice-card">
            <legend>Институт/Факультет *</legend>
            <div class="choices">
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт аэрокосмических приборов и систем" />
                <span>Институт аэрокосмических приборов и систем</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт радиотехники и инфокоммуникационных технологий" />
                <span>Институт радиотехники и инфокоммуникационных технологий</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт кибербезопасности и цифровых технологий" />
                <span>Институт кибербезопасности и цифровых технологий</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт информационных технологий и программирования" />
                <span>Институт информационных технологий и программирования</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт фундаментальной подготовки и технологических инноваций" />
                <span>Институт фундаментальной подготовки и технологических инноваций</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Гуманитарный факультет" />
                <span>Гуманитарный факультет</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Институт технологий предпринимательства и права" />
                <span>Институт технологий предпринимательства и права</span>
              </label>
              <label class="choice">
                <input type="checkbox" name="faculty" value="Военный учебный центр при ГУАП (ВУЦ)" />
                <span>Военный учебный центр при ГУАП (ВУЦ)</span>
              </label>
            </div>
            <p class="helper">Выберите один или несколько вариантов.</p>
          </fieldset>
        </section>

        <div class="actions">
          <button type="button" id="download" class="button">Скачать ответы</button>
          <p class="muted">Кнопка сформирует JSON-файл с вашими ответами.</p>
        </div>
      </form>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__content">
      <div class="footer__links">
        <a href="#section-general">К началу формы</a>
      </div>
    </div>
  </footer>

  <script>
    const form = document.getElementById('curator-form');
    const downloadButton = document.getElementById('download');

    function createRow(inputName, placeholder = '') {
      const row = document.createElement('div');
      row.className = 'multi-input__row';

      const input = document.createElement('input');
      input.type = 'text';
      input.name = inputName;
      input.required = true;
      input.placeholder = placeholder;

      const removeButton = document.createElement('button');
      removeButton.type = 'button';
      removeButton.className = 'multi-input__remove';
      removeButton.setAttribute('aria-label', 'Удалить запись');
      removeButton.textContent = '×';

      row.append(input, removeButton);
      return row;
    }

    function setupMultiInput({ name, inputName, placeholder = '' }) {
      const container = form.querySelector(`[data-name="${name}"]`);
      const addButton = form.querySelector(`[data-add="${name}"]`);

      if (!container || !addButton) return;

      function updateRemoveState() {
        const rows = container.querySelectorAll('.multi-input__row');
        rows.forEach((row) => {
          const removeButton = row.querySelector('.multi-input__remove');
          if (!removeButton) return;
          const isDisabled = rows.length === 1;
          removeButton.disabled = isDisabled;
        });
      }

      function attachRemove(row) {
        const removeButton = row.querySelector('.multi-input__remove');
        if (!removeButton) return;
        removeButton.addEventListener('click', () => {
          if (container.querySelectorAll('.multi-input__row').length === 1) return;
          row.remove();
          updateRemoveState();
        });
      }

      container.querySelectorAll('.multi-input__row').forEach((row) => attachRemove(row));

      addButton.addEventListener('click', () => {
        const newRow = createRow(inputName, placeholder);
        attachRemove(newRow);
        container.append(newRow);
        updateRemoveState();
      });

      updateRemoveState();
    }

    function collectFaculties() {
      return Array.from(form.querySelectorAll('input[name="faculty"]:checked')).map((input) => input.value);
    }

    function getValue(name) {
      return form.elements[name]?.value.trim() || '';
    }

    function collectList(name) {
      const container = form.querySelector(`[data-name="${name}"]`);
      if (!container) return [];
      return Array.from(container.querySelectorAll('input'))
        .map((input) => input.value.trim())
        .filter(Boolean);
    }

    function buildReport() {
      const payload = {
        fullName: getValue('fullName'),
        position: collectList('positions'),
        department: getValue('department'),
        phone: getValue('phone'),
        telegramHandle: getValue('telegramHandle'),
        email: getValue('email'),
        groupNumbers: collectList('groupNumbers'),
        baseBuilding: getValue('baseBuilding'),
        baseRoom: getValue('baseRoom'),
        faculties: collectFaculties(),
      };
      return JSON.stringify(payload, null, 2);
    }

    setupMultiInput({
      name: 'positions',
      inputName: 'position',
      placeholder: 'Например, преподаватель-практик или тьютор',
    });

    setupMultiInput({
      name: 'groupNumbers',
      inputName: 'groupNumber',
      placeholder: 'Например, 1234 или 4102',
    });

    downloadButton.addEventListener('click', () => {
      const report = buildReport();
      const blob = new Blob([report], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'curator-report.json';
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
